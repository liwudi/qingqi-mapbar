/**
 * Mapbar MobileMap Engine (C)2005 Mapbar Inc
 * version: mobileapi2.0
 * time:Thu Aug 25 2016 09:44:02 GMT+0800 (中国标准时间)
 */
var MEvent=new function(){var a,b=!1,c=[],d=document.createElement("div"),e=function(){for(var a=0,b=c.length;a<b;a++)c[a].apply(document);c=null},f={transitionend:{webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"}},g=function(c){b||(b=!0,e.call(window),document.removeEventListener?document.removeEventListener("DOMContentLoaded",g,!1):document.detachEvent&&(document.detachEvent("onreadystatechange",g),window==window.top&&(clearInterval(a),a=null)))};document.addEventListener?document.addEventListener("DOMContentLoaded",g,!1):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){new RegExp("loaded|complete").test(document.readyState)&&g()}),window==window.top&&(a=setInterval(function(){try{b||document.documentElement.doScroll("left")}catch(a){return}g()},0))),this.Events={transitionend:function(){var a="transitionend";return Object.keys(f.transitionend).some(function(b){if(b+"TransitionProperty"in d.style)return a=f.transitionend[b],!0}),a}()},this.ready=function(a,d){b?a.call(d||window):c.push(function(){return a.call(d||window)})};var h=function(a,b,c,d,e,f){var g;c._one=!!f;var h=function(f){f=f||window.event,g={e:f,target:a,type:b,data:e,preventDefault:function(){this.e&&MEvent.stopDefault(this.e)},stopPropagation:function(){this.e&&MEvent.stopPropagation(this.e)}},c.apply(d?d:a,[g]),c._one&&MEvent.unbind(a,b,c)};return h._p_=c,h._obj=a,h._context=d,h._data=e,h};this.eventSupported=function(a,b){if(void 0==a||"string"!=typeof a)return!1;b=b||MElement.create("div"),a="on"+a;var c=a in b;return b.setAttribute&&!c&&(b.setAttribute(a,"return;"),c="function"==typeof b[a]),b=null,c},this.stopDefault=function(a){if(a){if(a.target&&!0===MElement.hasClass(a.target,"MInfoWindow"))return;a.preventDefault?a.preventDefault():a.returnValue=!1}},this.stopPropagation=function(a){a&&(a.stopPropagation?a.stopPropagation():a.cancelBubble=!0)},this.one=function(a,b,c,d,e){this.bind(a,b,c,d,e,!0)},this.bind=function(a,b,c,d,e,f){a=MElement.$(a);var g,i,j=MElement.isElement(a);if(a.adapters||(a.adapters={}),j){a.adapters[b]||(a.adapters[b]=[]),g=h(a,b,c,d,e,f),i=!1;for(var k=0,l=a.adapters[b].length;k<l;k++)if(a.adapters[b][k]._p_===g._p_){i=!0;break}i||(a.adapters[b].push(g),a.addEventListener?a.addEventListener(b,g,!1):a.attachEvent&&a.attachEvent("on"+b,g))}else{a.adapters[b]||(a.adapters[b]=[]),i=!1;for(var m=0,n=a.adapters[b].length;m<n;m++)if(a.adapters[b][m].fun===c&&a.adapters[b][m].context===d){i=!0;break}i||a.adapters[b].push({fun:c,context:d,data:e,one:!!f})}},this.unbind=function(a,b,c,d){if(a){a=MElement.$(a);var e,f,g,h,i=MElement.isElement(a),j=[],k=[];if(i){if(b&&c&&a.adapters&&a.adapters[b]){g=a.adapters[b],e=-1;for(var l=0,m=g.length;l<m;l++)if(c==g[l]._p_){e=l;break}e>-1&&(f=g[e],a.removeEventListener?a.removeEventListener(b,f,!1):a.detachEvent&&a.detachEvent("on"+b,f),delete g[e],g.splice(e,1),0==g.length&&delete a.adapters[b])}else if(b&&!c&&a.adapters&&a.adapters[b]){g=a.adapters[b];for(var n=0,o=g.length;n<o;n++)j.push(g[n]._p_);for(var p=0,q=j.length;p<q;p++)this.unbind(a,b,j[p])}else if(!b&&a.adapters){for(var r in a.adapters)a.adapters.hasOwnProperty(r)&&k.push(r.toString());for(var s=0,t=k.length;s<t;s++)this.unbind(a,k[s]);delete a.adapters}}else if(b&&c&&a.adapters&&a.adapters[b]){h=a.adapters[b],e=-1;for(var u=0,v=h.length;u<v;u++)if((!d||d===h[u].context)&&c===h[u].fun){e=u;break}h.splice(e,1),0==h.length&&delete a.adapters[b]}else b&&!c&&a.adapters&&a.adapters[b]?delete a.adapters[b]:!b&&a.adapters&&delete a.adapters}},this.clear=function(a,b){this.unbind(a,b)},this.trigger=function(a,b){a=MElement.$(a);var c,d,e=MElement.isElement(a);if(a.adapters&&a.adapters[b])if(c=a.adapters[b],e)for(var f=0,g=c.length;f<g;f++)d=c[f],d._p_.apply(d._context?d._context:d._obj,[{target:a,type:b,preventDefault:function(){},stopPropagation:function(){},data:d._data}].concat(Array.prototype.slice.apply(arguments).slice(2))),d._p_._one&&MEvent.unbind(a,b,d._p_);else for(var h=0,i=c.length;h<i;h++)d=c[h].fun,d.apply(c[h].context?c[h].context:a,[{target:a,type:b,data:c[h].data}].concat(Array.prototype.slice.apply(arguments).slice(2))),c[h].one&&MEvent.unbind(a,b,d)},this.mouseWheel=function(a,b,c,d){this.bind(a,this.eventSupported("mousewheel")?"mousewheel":"DOMMouseScroll",function(a){var c=a.e,d=0;c.wheelDelta?(d=c.wheelDelta/120,window.opera&&window.opera.version()<10&&(d=-d)):c.detail&&(d=-c.detail/3),c.delta=Math.round(d),b.apply(this,[a])},c,d)}},MTools=new function(){var _ua=navigator.userAgent.toLowerCase(),_s,_hiddenDom,_supportCanvas,_createHiddenDom=function(){_hiddenDom||(_hiddenDom=document.createElement("div"),_hiddenDom.setAttribute("style","position:absolute;float:left;left:-10000px;top:-10000px;"),document.body.appendChild(_hiddenDom))};String.repeat||(String.repeat=function(a){return new Array(a+1).join(this)}),String.trim||(String.trim=function(){return this.replace(new RegExp("^\\s+|\\s+$","g"),"")}),Function.prototype.bind||(Function.prototype.bind=function(a){var b=Array.prototype.slice.call(arguments,1),c=this;return function(){return c.apply(a,b.concat(Array.prototype.slice.call(arguments)))}});var _EP_KEY=6,_CSL_RIGHT=2,_CSL_TOP=8,_CSL_BOTTOM=4,_CSL_LEFT=1,_argsToArray=function(a){return Array.prototype.slice.apply(a)},_obj2url=function(a){var b=[];for(var c in a){var d=typeof a[c];!a.hasOwnProperty(c)||"string"!=d&&"number"!=d||b.push(c+"="+a[c])}return b.join("&")},_serialNumber=function(){return Math.random().toString().replace(new RegExp("^0\\."),"")},_setContextOptions=function(a,b){for(var c in b)c in a&&(a[c]=b[c])};this.browser={},(_s=_ua.match(new RegExp("android ([\\d.]+);")))?this.browser.android=_s[1]:(_s=_ua.match(new RegExp("cpu iphone os ([\\d_]+)")))?this.browser.iphone=_s[1]:(_s=_ua.match(new RegExp("ipad; cpu os ([\\d_]+)")))?this.browser.ipad=_s[1]:0,(_s=_ua.match(new RegExp("msie ([\\d.]+)")))?this.browser.msie=_s[1]:(_s=_ua.match(new RegExp("firefox/([\\d.]+)")))?this.browser.firefox=_s[1]:(_s=_ua.match(new RegExp("chrome/([\\d.]+)")))?this.browser.chrome=_s[1]:(_s=_ua.match(new RegExp("opera.([\\d.]+)")))?this.browser.opera=_s[1]:(_s=_ua.match(new RegExp("version/([\\d.]+).*safari")))?this.browser.safari=_s[1]:0,this.supportSVG=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,this.supportRequestAnimationFrame=!!(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame),window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(a){setTimeout(a,1e3/60)},this.loops={},this.browserKernel={},this.between=function(a,b,c,d){return"number"!=typeof a||"number"!=typeof b||"number"!=typeof c?d:a<b||a>c?d:a},this.supportTouch=function(){return"ontouchstart"in document.body},this.cohenSutherland=function(a,b){var c,d,e,f=function(a,b,c,d,e,f){var g=0;return b>f?g|=_CSL_TOP:b<d&&(g|=_CSL_BOTTOM),a>e?g|=_CSL_RIGHT:a<c&&(g|=_CSL_LEFT),g},g=a.px1.x,h=a.px1.y,i=a.px2.x,j=a.px2.y,k=b.min.x,l=b.min.y,m=b.max.x,n=b.max.y,o=0,p=!1,q=!1;c=f(g,h,k,l,m,n),d=f(i,j,k,l,m,n);do{if(0==(c|d))p=!0,q=!0;else if((c&d)>0)q=!0;else{var r=0,s=0;e=0!=c?c:d,(e&_CSL_TOP)>0?(r=g+(i-g)*(n-h)/(j-h),s=n):(e&_CSL_BOTTOM)>0?(r=g+(i-g)*(l-h)/(j-h),s=l):(e&_CSL_RIGHT)>0?(s=h+(j-h)*(m-g)/(i-g),r=m):(e&_CSL_LEFT)>0&&(s=h+(j-h)*(k-g)/(i-g),r=k),e==c?(g=r,h=s,c=f(g,h,k,l,m,n)):(i=r,j=s,d=f(i,j,k,l,m,n))}o++}while(1!=q&&o<5e3);return p&&(a.px1.x=Math.floor(g),a.px1.y=Math.floor(h),a.px2.x=Math.floor(i),a.px2.y=Math.floor(j)),p},this.sutherlandHodgman=function(a,b){var c,d,e,f,g=[b.min,new MPixel(b.max.x,b.min.y),b.max,new MPixel(b.min.x,b.max.y)],h=function(a){return(d.x-c.x)*(a.y-c.y)>(d.y-c.y)*(a.x-c.x)},i=function(){var a=new MPixel(c.x-d.x,c.y-d.y),b=new MPixel(e.x-f.x,e.y-f.y),g=c.x*d.y-c.y*d.x,h=e.x*f.y-e.y*f.x,i=1/(a.x*b.y-a.y*b.x);return new MPixel(Math.round((g*b.x-h*a.x)*i),Math.round((g*b.y-h*a.y)*i))},j=a;c=g[g.length-1];for(var k in g){d=g[k];var l=j;j=[],e=l[l.length-1];for(var m in l)f=l[m],h(f)?(h(e)||j.push(i()),j.push(f)):h(e)&&j.push(i()),e=f;c=d}return j},this.removeNode=function(a){if(a instanceof Array)for(var b=0,c=a.length;b<c;b++)this.removeNode(a[b]);else{if(!MElement.isElement(a))return;a.parentNode?a.parentNode.removeChild(a):(_hiddenDom||_createHiddenDom(),_hiddenDom.appendChild(a),_hiddenDom.removeChild(a)),a=null}},this.timeout=function(a,b,c){var d=_argsToArray(arguments).slice(3);return"object"!=typeof a||"function"!=typeof b||"number"!=typeof c?null:setTimeout(function(){b.apply(a,d)},parseInt(c,10))},this.interval=function(a,b,c){var d=_argsToArray(arguments).slice(3);return"object"!=typeof a||"function"!=typeof b||"number"!=typeof c?null:setInterval(function(){b.apply(a,d)},parseInt(c))},this.continuous=function(a,b){if("function"==typeof a){var c=b?function(){a.apply(b);var c=arguments.callee;c.loop&&MTools.requestAnimationFrame.call(window,c)}:function(){a();var b=arguments.callee;b.loop&&MTools.requestAnimationFrame.call(window,b)};c.loop=!0;var d=MTools.requestAnimationFrame.call(window,c);return MTools.loops[d]=c,d}return null},this.clearContinuous=function(a){MTools.loops[a].loop=!1,delete MTools.loops[a]},this.arrayContains=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},this.extend=function(){var a,b=!1,c=!1;if("boolean"==typeof arguments[0]){if(null===arguments[1]&&"object"==typeof arguments[1])return null;b=!0,c=arguments[0]}else if("object"==typeof arguments[0]&&null===arguments[0])return null;a={};for(var d=b?1:0,e=arguments.length;d<e;d++){var f=arguments[d];for(var g in f){var h=f[g];null!=h&&"object"==typeof h&&c?(a[g]={},this.extend(c,a[g],h)):a[g]=h}}return a},this.measSize=function(a){_hiddenDom||_createHiddenDom(),_hiddenDom.innerHTML=a;var b=new MSize(_hiddenDom.clientWidth,_hiddenDom.clientHeight);return _hiddenDom.innerHTML="",b},this.camelize=function(a){return a.replace(new RegExp("-(\\w)","g"),function(a,b){return b.toUpperCase()})},this.uncamelize=function(a,b){return a.replace(new RegExp("(\\w)([A-Z])","g"),function(a,c,d){return c+(b?b:"-")+d.toLowerCase()})},this.ifUndefined=function(a,b){return"undefined"==typeof a?b:a},this.ifTypeOf=function(a,b,c){return typeof a===b?a:c},this.ifInstanceOf=function(a,b,c){return a instanceof b?a:c},this.decodeNumberEx=function(a){var b=0,c=[],d=a.length;if(d<=0)return c;for(;b<d;){var e=0,f=0,g=0,h=_EP_KEY;do{e=a.charCodeAt(b++)-63;var i=31&(e>>1^h++);g|=i<<f,f+=5}while(0==(1&e));g=1==(1&g)?~(g>>1):g>>1,c.push(g)}return c},this.isArray=function(a){return a instanceof Array},this.encode13=function(a,b){var c="",d=3409,e=parseInt(1e5*parseFloat(Math.max(-90,Math.min(90,b)))),f=parseInt(1e5*parseFloat(a<0?this.lng+360:a)),g=f-e+d,h=f+e;g<0&&(c="X",g=-g),h<0&&(c="Y",h=-h);for(var i=g.toString(16),j=h.toString(16),k=0;k<i.length;k++){var l=parseInt(i.charAt(k),16);c+=((l>=10?l+7:l)+10).toString(36)}c+="z";for(var m=0;m<j.length;m++){var n=parseInt(j.charAt(m),16);c+=((n>=10?n+7:n)+10).toString(36)}return c.toUpperCase()},this.decode13=function(a){var b=[0,0],c=-1,d=0,e="",f=3409,g="";null!=a&&parseInt(a.charAt(0),36)>=33&&(g=a.charAt(0),a=a.substring(1));for(var h=0;h<a.length-0;h++){var i=parseInt(a.charAt(h),36)-10;i>=17&&(i-=7),e+=i.toString(36),i>d&&(c=h,d=i)}var j=parseInt(e.substring(0,c),16),k=parseInt(e.substring(c+1),16);return"X"==g&&(j=-j),"Y"==g&&(k=-k),b[0]=(j+k-f)/2,b[1]=(k-b[0])/1e5,b[0]/=1e5,b[0]>180&&(b[0]-=360),new MPoint(b[0],b[1])},this.parseJSON=function(s){return JSON&&JSON.parse&&"function"==typeof JSON.parse?JSON.parse(s):eval("("+s+")")},this.getCss3Option=function(a,b){var c={};return c[a]=b,c["-webkit-"+a]=b,c["-moz-"+a]=b,c},this.getRequestObject=function(a){var b=!1,c=a.context;if(window.XMLHttpRequest?b=new window.XMLHttpRequest:window.ActiveXObject&&(b=new window.ActiveXObject("Microsoft.XMLHTTP")),!b)return!1;if(a=a||{},a.method=a.method||"GET",a.async=a.async||!0,!a.url)throw new Error("[url] parameter is not set");if("GET"===a.method&&a.data&&(a.url+="?"+_obj2url(a.data)),b.onreadystatechange=function(){switch(b.readyState){case 1:"function"==typeof a.loadListener&&a.loadListener.apply(c?c:b,arguments);break;case 2:"function"==typeof a.loadedListener&&a.loadedListener.apply(c?c:b,arguments);break;case 3:"function"==typeof a.inerativeListener&&a.ineractiveListener.apply(c?c:b,arguments);break;case 4:b.status&&200==b.status?"function"==typeof a.success&&a.success.call(c?c:b,b.responseText):"function"==typeof a.error&&a.error.apply(c?c:b,arguments)}},b.open(a.method,a.url,a.async,a.username,a.password),a.headers){var d,e=a.headers;for(var f in e)d=typeof e[f],!a.header.hasOwnProperty||"string"!=d&&"number"!=d||b.setRequestHeader(f.toString(),e[f].toString())}return b},this.ajaxRequest=function(a){a=a||{},a.method=a.method||"GET",a.async=a.async||!0;var b=this.getRequestObject(a);return b.send("POST"==a.method&&a.data?_obj2url(a.data):null),b},this.JSONP=function(a){var b,c=a.callbackname?a.callbackname:"jsonp"+_serialNumber(),d=a.context,e=function(){window[c]=void 0,a.error&&a.error.apply(d?d:window)};if(a=a||{},a.jsonp=a.jsonp||"callback",a.timeout=a.timeout||3e4,a.data=a.data||{},a.data[a.jsonp]=c,!a.url)throw new Error("[url] parameter is not set");var f,g=_obj2url(a.data);window[c]=function(){window.clearTimeout(b),window[c]=void 0,document.getElementsByTagName("head")[0].removeChild(f),a.success&&a.success.apply(d?d:window,arguments)},a.url+="?"+g,f=MElement.create("script",{type:"text/javascript",src:a.url}),document.getElementsByTagName("head")[0].appendChild(f),b=this.timeout(null,e,parseInt(a.timeout))},this.loadScript=function(a,b){if(!a)throw new Error("[url] parameter is not set");b=b||{},b.cache="boolean"!=typeof b.cache||b.cache,a+=b.cache?"":(a.indexOf("?")==-1?"?":"&")+"ran="+Math.random();var c=function(a){document.getElementsByTagName("head")[0].removeChild(a)},d=MElement.create("script",{type:"text/javascript",src:a});MEvent.bind(d,"readystatechange",function(){var a=b.success,d=b.complete,e=b.context;"loaded"!==this.readyState||this.getAttribute("error")||("function"==typeof a&&(e?a.apply(e):a()),"function"==typeof d&&(e?d.apply(e):d())),c(this)}),MEvent.bind(d,"load",function(){var a=b.success,d=b.complete,e=b.context;"function"==typeof a&&(e?a.apply(e):a()),"function"==typeof d&&(e?d.apply(e):d()),c(this)}),MEvent.bind(d,"error",function(){var a=b.error,d=b.complete,e=b.context;"function"==typeof a&&(e?a.apply(e):a()),this.readyState?this.setAttribute("error","true"):("function"==typeof d&&(e?d.apply(e):d()),c(this))}),document.getElementsByTagName("head")[0].appendChild(d)},this.colorHex=function(a){a=a.replace(new RegExp("\\s","g"),"").toLowerCase();var b=a.match(new RegExp("^(rgb|rgba)\\((\\d+)\\,(\\d+)\\,(\\d+)(\\,(\\d\\.?\\d?))?\\)$"));if(b){var c=parseInt(b[2]).toString(16),d=parseInt(b[3]).toString(16),e=parseInt(b[4]).toString(16);return c=1==c.length?"0"==c?c+c:"0"+c:c,d=1==d.length?"0"==d?d+d:"0"+d:d,e=1==e.length?"0"==e?e+e:"0"+e:e,"#"+c+d+e}return null},this.colorRgb=function(a,b){a=a.replace(new RegExp("\\s","g"),"").toLowerCase();var c=a.match(new RegExp("^(#)?([0-9a-z]{6}|[0-9a-z]{3})$")),d=new RegExp("^([\\d\\w]{1,2})([\\d\\w]{1,2})([\\d\\w]{1,2})$");if(c){var e=c[2].match(d),f=parseInt("0x"+(1==e[1].length?e[1]+e[1]:e[1])),g=parseInt("0x"+(1==e[2].length?e[2]+e[2]:e[2])),h=parseInt("0x"+(1==e[3].length?e[3]+e[3]:e[3])),i=[];return i.push(b?"rgba("+f:"rgb("+f),i.push(g),i.push(b?h:h+")"),i.push(b?b+")":""),i.join(",")}return new RegExp("^(rgb|rgba)\\((\\d+)\\,(\\d+)\\,(\\d+)(\\,(\\d\\.?\\d?))?\\)$").test(a)?a:null},this.importStylesheet=function(a,b){b="number"!=typeof b?0:b;var c=0==b,d=c?MElement.create$("style"):MElement.create$("link");d.setAttr({type:"text/css"}),c?d.html(a):d.setAttr({ref:"stylesheet",href:a}),document.getElementsByTagName("head")[0].appendChild(d.get(0))},this.supportCanvas=function(){return"undefined"==typeof _supportCanvas&&(_supportCanvas=!!document.createElement("canvas").getContext),_supportCanvas},this.clearCanvas=function(a,b,c){if(a){var d=MClass.classOf(b,MPixel)?b:new MPixel(0,0),e=MClass.classOf(c,MSize)?c:new MSize(a.canvas.width,a.canvas.height);a.clearRect(d.x,d.y,e.width,e.height)}},this.paintLine=function(a,b,c,d){c=c||{};var e=b.length;if(e>1){a.save(),_setContextOptions(a,c),a.beginPath(),a.moveTo(b[0].x,b[0].y);for(var f=1;f<e;f++){var g=b[f];a.lineTo(g.x,g.y)}d&&a.closePath(),a.stroke(),d&&a.fill(),a.restore()}},this.paintLines=function(a,b,c){c=c||{};var d=b.length;if(d>0){a.save(),_setContextOptions(a,c),a.beginPath();for(var e=0;e<d;e++){var f=b[e],g=f.length;a.moveTo(f[0].x,f[0].y);for(var h=1;h<g;h++){var i=f[h];a.lineTo(i.x,i.y)}}a.stroke(),a.restore()}},this.paintCircle=function(a,b,c,d,e,f){f=f||{},a.save(),_setContextOptions(a,f),a.beginPath(),a.arc(b.x,b.y,c,0,Math.PI/180*360,!0),e&&a.stroke(),d&&a.fill(),a.restore()},this.paintImage=function(a,b,c,d,e,f){c=MClass.classOf(c,MPixel)?c:new MPixel(0,0);var g=MClass.classOf(d,MSize),h=MClass.classOf(e,MPixel),i=MClass.classOf(f,MSize);a&&b&&(g&&h&&i?a.drawImage(b,e.x,e.y,f.width,f.height,c.x,c.y,d.width,d.height):g?a.drawImage(b,c.x,c.y,d.width,d.height):a.drawImage(b,c.x,c.y))},this.getViewportScale=function(){return MTools.browser.ipad||MTools.browser.iphone?this.getViewportScale=function(){return 90===Math.abs(window.orientation)?window.innerWidth/Math.max(screen.width,screen.height):window.innerWidth/Math.min(screen.width,screen.height)}:this.getViewportScale=function(){return 1},this.getViewportScale()},this.tween={Linear:function(a,b,c,d){return c*a/d+b},Quad:{easeIn:function(a,b,c,d){return c*(a/=d)*a+b},easeOut:function(a,b,c,d){return-c*(a/=d)*(a-2)+b},easeInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a+b:-c/2*(--a*(a-2)-1)+b}},Cubic:{easeIn:function(a,b,c,d){return c*(a/=d)*a*a+b},easeOut:function(a,b,c,d){return c*((a=a/d-1)*a*a+1)+b},easeInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a+b:c/2*((a-=2)*a*a+2)+b}},Quart:{easeIn:function(a,b,c,d){return c*(a/=d)*a*a*a+b},easeOut:function(a,b,c,d){return-c*((a=a/d-1)*a*a*a-1)+b},easeInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a+b:-c/2*((a-=2)*a*a*a-2)+b}},Quint:{easeIn:function(a,b,c,d){return c*(a/=d)*a*a*a*a+b},easeOut:function(a,b,c,d){return c*((a=a/d-1)*a*a*a*a+1)+b},easeInOut:function(a,b,c,d){return(a/=d/2)<1?c/2*a*a*a*a*a+b:c/2*((a-=2)*a*a*a*a+2)+b}},Sine:{easeIn:function(a,b,c,d){return-c*Math.cos(a/d*(Math.PI/2))+c+b},easeOut:function(a,b,c,d){return c*Math.sin(a/d*(Math.PI/2))+b},easeInOut:function(a,b,c,d){return-c/2*(Math.cos(Math.PI*a/d)-1)+b}},Expo:{easeIn:function(a,b,c,d){return 0==a?b:c*Math.pow(2,10*(a/d-1))+b},easeOut:function(a,b,c,d){return a==d?b+c:c*(-Math.pow(2,-10*a/d)+1)+b},easeInOut:function(a,b,c,d){return 0==a?b:a==d?b+c:(a/=d/2)<1?c/2*Math.pow(2,10*(a-1))+b:c/2*(-Math.pow(2,-10*--a)+2)+b}},Circ:{easeIn:function(a,b,c,d){return-c*(Math.sqrt(1-(a/=d)*a)-1)+b},easeOut:function(a,b,c,d){return c*Math.sqrt(1-(a=a/d-1)*a)+b},easeInOut:function(a,b,c,d){return(a/=d/2)<1?-c/2*(Math.sqrt(1-a*a)-1)+b:c/2*(Math.sqrt(1-(a-=2)*a)+1)+b}},Elastic:{easeIn:function(a,b,c,d,e,f){if(0==a)return b;if(1==(a/=d))return b+c;if(f||(f=.3*d),!e||e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return-(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*(2*Math.PI)/f))+b},easeOut:function(a,b,c,d,e,f){if(0==a)return b;if(1==(a/=d))return b+c;if(f||(f=.3*d),!e||e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return e*Math.pow(2,-10*a)*Math.sin((a*d-g)*(2*Math.PI)/f)+c+b},easeInOut:function(a,b,c,d,e,f){if(0==a)return b;if(2==(a/=d/2))return b+c;if(f||(f=d*(.3*1.5)),!e||e<Math.abs(c)){e=c;var g=f/4}else var g=f/(2*Math.PI)*Math.asin(c/e);return a<1?-.5*(e*Math.pow(2,10*(a-=1))*Math.sin((a*d-g)*(2*Math.PI)/f))+b:e*Math.pow(2,-10*(a-=1))*Math.sin((a*d-g)*(2*Math.PI)/f)*.5+c+b}},Back:{easeIn:function(a,b,c,d,e){return void 0==e&&(e=1.70158),c*(a/=d)*a*((e+1)*a-e)+b},easeOut:function(a,b,c,d,e){return void 0==e&&(e=1.70158),c*((a=a/d-1)*a*((e+1)*a+e)+1)+b},easeInOut:function(a,b,c,d,e){return void 0==e&&(e=1.70158),(a/=d/2)<1?c/2*(a*a*(((e*=1.525)+1)*a-e))+b:c/2*((a-=2)*a*(((e*=1.525)+1)*a+e)+2)+b}},Bounce:{easeIn:function(a,b,c,d){return c-Tween.Bounce.easeOut(d-a,0,c,d)+b},easeOut:function(a,b,c,d){return(a/=d)<1/2.75?c*(7.5625*a*a)+b:a<2/2.75?c*(7.5625*(a-=1.5/2.75)*a+.75)+b:a<2.5/2.75?c*(7.5625*(a-=2.25/2.75)*a+.9375)+b:c*(7.5625*(a-=2.625/2.75)*a+.984375)+b},easeInOut:function(a,b,c,d){return a<d/2?.5*Tween.Bounce.easeIn(2*a,0,c,d)+b:.5*Tween.Bounce.easeOut(2*a-d,0,c,d)+.5*c+b}}}},MClass=new function(){var a={},b=function(b){return b instanceof Function&&c(a[this.className],b)},c=function(a,b){if(a&&b){if(b===a.prototype.superClass)return!0;var d=a.prototype;return!(!d||!d.superClass)&&c(d.superClass,b)}return!1};this.classOf=function(a,b,c){return a&&a instanceof b?3!==arguments.length||a:3===arguments.length&&c},this.create=function(c,d){var e=function(){e.initialize instanceof Function&&e.initialize.apply(this,arguments)};if(a[c]&&delete a[c],a[c]=e,d instanceof Function){var f=function(){};f.prototype=d.prototype,e.prototype=new f}return e.prototype.constructor=e,e.prototype.superClass=d,e.prototype.className=c,e.prototype.superClassOf=b,e},this.finalize=function(a){a.hasOwnProperty("__proto__")&&(a.__proto__=null);for(var b in a)a[b]=null},this.chkObj=function(a,b){return a&&a instanceof b?a:null}},MObject=MClass.create("MObject");MObject.prototype.getType=function(){return this.constructor},MObject.prototype.getTypeString=function(){return this.className},MObject.prototype.clone=function(){return null},MObject.prototype.equals=function(a){return this==a},MObject.prototype.toString=function(){return this.className},MObject.prototype.finalize=function(){for(var a in this)this[a]=null,delete this[a];MClass.finalize(this)};var MPixel=MClass.create("MPixel",MObject);MPixel.initialize=function(a,b){this.x="number"==typeof a?a:0,this.y="number"==typeof b?b:0},MPixel.prototype.clone=function(){return new MPixel(this.x,this.y)},MPixel.prototype.equals=function(a){return a instanceof MPixel&&this.x==a.x&&this.y==a.y},MPixel.prototype.toString=function(){return this.className+": {"+this.x+", "+this.y+"}"};var MSize=MClass.create("MSize",MObject);MSize.initialize=function(a,b){a="number"!=typeof a?0:a,b="number"!=typeof b?0:b,this.width=a,this.height=b},MSize.prototype.clone=function(){return new MSize(this.width,this.height)},MSize.prototype.equals=function(a){return a instanceof MSize&&this.width==a.width&&this.height==a.height},MSize.prototype.toString=function(){return this.className+": {"+this.width+", "+this.height+"}"};var MBounds=MClass.create("MBounds",MObject);MBounds.initialize=function(a,b){this.min=a&&a instanceof MPoint?a:null,this.max=b&&b instanceof MPoint?b:null},MBounds.prototype.mid=function(){return this.min&&this.max?new MPoint((this.min.lng+this.max.lng)/2,(this.min.lat+this.max.lat)/2):null},MBounds.prototype.contains=function(a){return!!(this.min&&this.max&&a instanceof MPoint)&&(a.lng>=this.min.lng&&a.lat>=this.min.lat&&a.lng<=this.max.lng&&a.lat<=this.max.lat)},MBounds.prototype.containsRange=function(a){return a instanceof MBounds&&(this.contains(a.min)&&this.contains(a.max))},MBounds.prototype.intersects=function(a){if(a&&a instanceof MBounds){var b=new MPoint(Math.max(this.min.lng,a.min.lng),Math.max(this.min.lat,a.min.lat)),c=new MPoint(Math.min(this.max.lng,a.max.lng),Math.min(this.max.lat,a.max.lat));return b.lng<=c.lng&&b.lat<=c.lat?new MBounds(b,c):null}return null},MBounds.prototype.isIntersect=function(a){if(a instanceof MBounds){var b=new MPoint(Math.max(this.min.lng,a.min.lng),Math.max(this.min.lat,a.min.lat)),c=new MPoint(Math.min(this.max.lng,a.max.lng),Math.min(this.max.lat,a.max.lat));return b.lng<=c.lng&&b.lat<=c.lat}return!1},MBounds.prototype.extends=function(a){if(a instanceof MPoint)this.contains(a)||(this.max.lng=Math.max(a.lng,this.max.lng),this.max.lat=Math.max(a.lat,this.max.lat),this.min.lng=Math.min(a.lng,this.min.lng),this.min.lat=Math.min(a.lat,this.min.lat));else if(a instanceof Array)for(var b=0,c=a.length;b<c;b++)this.extends(a[b])},MBounds.prototype.clone=function(){return new MBounds(this.min,this.max)},MBounds.prototype.equals=function(a){return a instanceof MBounds&&this.max.equals(a.max)&&this.min.equals(a.min)},MBounds.prototype.toString=function(){return this.className+": {"+this.min.toString()+", "+this.max.toString()+"}"};var MAnime=MClass.create("MAnime",MObject);MAnime.initialize=function(a){this._initOptions(a),this._status=void 0,this._current=void 0,this._timer=void 0},MAnime.prototype.start=function(){return this.stop(),this._current=1/this._fps,this._status=1,this._timer=MTools.interval(this,MAnime.AnimationExec(this),1e3/this._fps),this},MAnime.prototype.stop=function(){return this._timer&&window.clearInterval(this._timer),this._timer=null,this._status=0,this._current=-1,1==arguments[0]&&MEvent.trigger(this,"stoped"),this},MAnime.prototype.runing=function(){return!!this._status},MAnime.prototype.getStatus=function(){return this._status},MAnime.prototype.setBegins=function(a){return this._begins=a,this},MAnime.prototype.setEnds=function(a){return this._ends=a,this},MAnime.prototype.getCurrent=function(){return this._current},MAnime.prototype.setCurrent=function(a){return this._current=a,this},MAnime.prototype.getDuration=function(){return this._duration},MAnime.prototype.setDuration=function(a){return this._duration=a,this},MAnime.prototype.getFps=function(){return this._fps},MAnime.prototype.setFps=function(a){return this._fps=a,this},MAnime.prototype.frame=function(a){var b=this._begins,c=this._ends,d=this._method,e=this._duration,f=this._fps,g={},h={};for(var i in b)if(b.hasOwnProperty(i)&&c.hasOwnProperty(i)){var j,k,l=c[i]-b[i];if(0!=e){j=d(a,b[i],l,e);var m=a-1/f;m<0&&(m=0),k=j-d(m,b[i],l,e)}else j=c[i],k=l;g[i]=parseFloat(j,10),h[i]=parseFloat(k,10)}this._qFxFrame(g,h)},MAnime.AnimationExec=function(a){return function(){var b=a.getCurrent(),c=a.getDuration(),d=a.getFps();return b>c&&(b=c),a.frame(b),b>=c?void a.stop(!0):void a.setCurrent(b+1/d)}},MAnime.prototype._initOptions=function(a){a=a||{},this._begins=MTools.ifUndefined(a.begins,{}),this._ends=MTools.ifUndefined(a.ends,{}),this._method=MTools.ifUndefined(a.method,MAnime._easeOutCubic),this._duration=MTools.ifUndefined(a.duration,0),this._fps=MTools.ifUndefined(a.fps,40)},MAnime.prototype._qFxFrame=function(a,b){MEvent.trigger(this,"changed",a,b)},MAnime._easeOutCubic=function(a,b,c,d){return c*(Math.pow(a/d-1,3)+1)+b};var MElement=function(a){if(this._elements=[],!a)return this;if(a.nodeType)return this._elements.push(a),this;if("body"===a&&document.body)return this._elements.push(document.body),this;if("string"==typeof a){var b=new RegExp(/^<(\\w+)\\s*\/?>(?:<\/\1>)?$/).exec(a);if(b)this._elements.push(document.createElement(b[1]));else{b=a.split(new RegExp("\\s*,\\s*"));for(var c=0,d=b.length;c<d;c++)this._elements.push(document.getElementById(b[c]))}return this}if(a instanceof Array){for(var c=0,d=a.length;c<d;c++){var e=a[c];if(e.nodeType)this._elements.push(e);else if(e instanceof MElement){var f=e.get();this._elements=this._elements.concat(f)}else"string"==typeof e&&this._elements.push(document.getElementById(e))}return this}};MElement.prototype={className:"MElement",toString:function(){return this.className},each:function(a){for(var b=0,c=this._elements.length;b<c&&a.call(this._elements[b],b)!==!1;b++);return this},length:function(){return this._elements.length},eq:function(a){return new MElement(this._elements[a])},get:function(a){return"number"==typeof a?this._elements[a]:this._elements.concat()},setAttr:function(a,b){var c=arguments[0],d=arguments[1];if("string"==typeof c)"string"==typeof d?this.each(function(){this.setAttribute(c,d)}):"function"==typeof d&&this.each(function(){this.setAttribute(c,d.apply(this))});else if("object"==typeof c)for(var e in c)this.each(function(){this.setAttribute(e,c[e])});return this},attr:function(a){return this._elements[0].getAttribute(a)},removeAttr:function(a){return this.each(function(){this.removeAttribute(a)}),this},html:function(a){return"string"!=typeof a?this._elements[0].innerHTML:(this.each(function(){this.innerHTML=a}),this)},setCss:function(a,b){if("string"==typeof a&&"string"==typeof b)this.each(function(){this.style.setProperty?this.style.setProperty(MTools.uncamelize(a),b,null):this.style[MTools.uncamelize(a)]=b});else if("object"==typeof a)for(var c in a)this.each(function(){this.style.setProperty?this.style.setProperty(MTools.uncamelize(c.toString()),a[c].toString(),null):this.style[MTools.uncamelize(c.toString())]=a[c].toString()});return this},setCss3:function(a,b){if("string"==typeof a&&"string"==typeof b)this.setCss(MTools.getCss3Option(a,b));else if("object"==typeof a)for(var c in a)this.setCss3(c,a[c]);return this},css:function(a){var b,c=this._elements[0];return c&&(document.defaultView?b=document.defaultView.getComputedStyle(c,null).getPropertyValue(a):(b=c.currentStyle[a],b="medium"==b?"0px":"undefined"==typeof b?"0px":b)),b},addClass:function(a){return this.each(function(){MElement.addClass(this,a)}),this},removeClass:function(a){return this.each(function(){MElement.removeClass(this,a)}),this},children:function(){var a=[];return this.each(function(){for(var b=this.children,c=0,d=b.length;c<d;c++)a.push(b[c])}),new MElement(a)},parent:function(){var a=[];return this.each(function(b){var c=!1;if(b>0)for(var d=0,e=a.length;d<e;d++)if(a[d]==this.parentNode){c=!0;break}!c&&a.push(this.parentNode)}),new MElement(a)},remove:function(){return this.each(function(){MTools.removeNode(this)}),this},empty:function(){return this.each(function(){for(var a=this.children;a.length>0;)MTools.removeNode(a[0])}),this},clone:function(a){var b=[];return this.each(function(){b.push(this.cloneNode(a))}),new MElement(b)},append:function(a){var b="string"==typeof a?0:MElement.isElement(a)?1:a instanceof MElement?2:-1;return this.each(function(c){if(0==b)this.html(a);else{if(1==b)return this.appendChild(a),!1;if(2==b){for(var d=0,e=a.length();d<e;d++)this.appendChild(a.get(d));return!1}}}),this},appendTo:function(a){return(MElement.isElement(a)||"string"==typeof a)&&(a=new MElement([a])),a.append(this),this},show:function(){return this.setCss("display","block"),this},hide:function(){return this.setCss("display","none"),this},offset:function(){for(var a,b=this.eq(0),c=b.position(),d=b.parent();!MElement.isDocument(d.get(0));)a=d.position(),c.x+=a.x,c.y+=a.y,d=d.parent();return c},position:function(){var a=this._elements[0];return a?new MPixel(a.offsetLeft,a.offsetTop):null},innerSize:function(a){var b=this.eq(0),c=this._elements[0];a="undefined"==typeof a||a;var d,e;if(MElement.isElement(c))return d=c.offsetWidth-Math.round(parseFloat(b.css("border-left-width")))-Math.round(parseFloat(b.css("border-right-width"))),e=c.offsetHeight-Math.round(parseFloat(b.css("border-top-width")))-Math.round(parseFloat(b.css("border-bottom-width"))),a||(d-=Math.round(parseFloat(b.css("padding-left")))+Math.round(parseFloat(b.css("padding-right"))),e-=Math.round(parseFloat(b.css("padding-top")))+Math.round(parseFloat(b.css("padding-bottom")))),new MSize(d,e)},outerSize:function(a){var b=this.eq(0),c=this._elements[0];if(a="undefined"!=typeof a&&a,MElement.isElement(c)){var d=c.offsetWidth,e=c.offsetHeight;return a&&(d+=Math.round(parseFloat(b.css("margin-left")))+Math.round(parseFloat(b.css("margin-right"))),e+=Math.round(parseFloat(b.css("margin-top")))+Math.round(parseFloat(b.css("margin-bottom")))),new MSize(d,e)}return new MSize(0,0)},bind:function(a,b,c,d){return this.each(function(){MEvent.bind(this,a,b,c,d)}),this},unbind:function(a,b,c){return this.each(function(){MEvent.unbind(this,a,b,c)}),this},click:function(a,b,c){return this.bind("click",a,b,c)},dblclick:function(a,b,c){return this.bind("dblclick",a,b,c);
},mousedown:function(a,b,c){return this.bind("mousedown",a,b,c)},mouseup:function(a,b,c){return this.bind("mouseup",a,b,c)},mousemove:function(a,b,c){return this.bind("mousemove",a,b,c)},mouseover:function(a,b,c){return this.bind("mouseover",a,b,c)},mouseout:function(a,b,c){return this.bind("mouseout",a,b,c)},touchstart:function(a,b,c){return this.bind("touchstart",a,b,c)},touchmove:function(a,b,c){return this.bind("touchmove",a,b,c)},touchend:function(a,b,c){return this.bind("touchend",a,b,c)},mousewheel:function(a,b,c){return this.each(function(){MEvent.mouseWheel(this,a,b,c)}),this}},MElement.$$=function(a){return new MElement(a)},MElement.$=function(a){for(var b=[],c=0,d=arguments.length;c<d;c++){var e=arguments[c];if("string"==typeof e&&(e=document.getElementById(e)),1==d)return e;b.push(e)}return b},MElement.create$=function(a){var b;try{b=document.createElement(a)}catch(a){throw new Error(a.message)}return this.$$(b)},MElement.createSVG$=function(a){return this.$$(this.createSVG(a))},MElement.create=function(a,b,c){try{var d=document.createElement(a);return this.setAttr(d,b),MElement.isElement(c)&&c.appendChild(d),d}catch(a){throw new Error(a.message)}},MElement.createSVG=function(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg",a);return this.setAttr(d,b),MElement.isElement(c)&&c.appendChild(d),d},MElement.setAttr=function(a,b){if(a instanceof Array){for(var c=[],d=0,e=a.length;d<e;d++){var f=this.setAttr(a[d],b);f&&c.push(f)}return c}if(!(a=this.$(a)))return null;for(var g in b)b.hasOwnProperty(g)&&a.setAttribute(g,b[g]);return a},MElement.setStyle=function(a,b){MElement.$$(a).setCss(b)},MElement.isElement=function(a,b){return"object"==typeof a&&null!=a&&(a==window||a==document||1==a.nodeType&&(!b||a.tagName==b.toUpperCase()))},MElement.hasClass=function(a,b){return!(!MElement.isElement(a)||"string"!=typeof b)&&new RegExp("(\\s+|^)"+b+"(\\s+|$)").test(a.className)},MElement.addClass=function(a,b){MElement.isElement(a)&&"string"==typeof b&&(MElement.hasClass(a,b)||(a.className+=" "+b))},MElement.removeClass=function(a,b){MElement.isElement(a)&&("string"==typeof b?a.className=a.className.replace(new RegExp("(\\s+|^)"+b+"(\\s+|$)"),""):a.className="")},MElement.isDocument=function(a){return"object"==typeof a&&null!=a&&a==document};var MPixelBounds=MClass.create("MPixelBounds",MObject);MPixelBounds.initialize=function(a,b){this.min=MClass.classOf(a,MPixel,null),this.max=MClass.classOf(b,MPixel,null),this._size=null},MPixelBounds.prototype.mid=function(){return new MPixel(Math.round(this.min.x+(this.max.x-this.min.x)/2),Math.round(this.min.y+(this.max.y-this.min.y)/2))},MPixelBounds.prototype.contains=function(a){return!!MClass.classOf(a,MPixel)&&(a.x>=this.min.x&&a.x<=this.max.x&&a.y>=this.min.y&&a.y<=this.max.y)},MPixelBounds.prototype.intersects=function(a){if(MClass.classOf(a,MPixelBounds)){var b=this.min.x>a.min.x?this.min.x:a.min.x,c=this.min.y>a.min.y?this.min.y:a.min.y,d=this.max.x<a.max.x?this.max.x:a.max.x,e=this.max.y<a.max.y?this.max.y:a.max.y;return b<=d&&c<=e?new MPixelBounds(new MPixel(b,c),new MPixel(d,e)):null}return null},MPixelBounds.prototype.size=function(){return this._size instanceof MSize||(this._size=new MSize(Math.round(this.max.x-this.min.x),Math.round(this.max.y-this.min.y))),this._size},MPixelBounds.prototype.extends=function(a){if(a instanceof MPixel)this.contains(a)||(this.max.x=Math.max(a.x,this.max.x),this.max.y=Math.max(a.y,this.max.y),this.min.x=Math.min(a.x,this.min.x),this.min.y=Math.min(a.y,this.min.y),this._size=null);else if(a instanceof Array)for(var b=0,c=a.length;b<c;b++)this.extends(a[b])},MPixelBounds.prototype.clone=function(){return new MPixelBounds(this.min,this.max)},MPixelBounds.prototype.equals=function(a){return MClass.classOf(a,MPixelBounds)&&this.min.equals(a.min)&&this.max.equals(a.max)},MPixelBounds.prototype.toString=function(){return this.className+": {"+this.min.toString()+", "+this.max.toString()+"}"};var MMapMode={PAN:1,MARKER:2},MPointType={CODE13:1,CODE14:2,M09:3,WGS84:4,GCJ02:5},MTilePathType={RELATIVE:1,ABSOLUTE:2},MPositionType={LEFT_TOP:0,LEFT_BOTTOM:1,RIGHT_TOP:2,RIGHT_BOTTOM:3,CENTER_BOTTOM:4},MSysLayerZIndex={MAP_CONTAINER:2,MAP_BACKGROUND:0,MAP_LAYER:1,TRAFFIC_LAYER:2,LAYERS_CONTAINER:3,SVG_CONTAINER:4,SHADOW_CONTAINER:5,MARKER_CONTAINER:6,HANDLE_CONTAINER:7,IW_CONTAINER:8,PANEL_CONTAINER:10},MGridEventAction={NORMAL:0,DRAGGING:1},MStrokeStyle={SOLID:0,DASHED:1,SHORTDASHED:2,LONGDASHED:3,DOTTED:4,SHORTDOTTED:5,DOTDASHED:6,SHORTDOTDASHED:7,LONGDOTDASHED:8},MIcon=MClass.create("MIcon",MObject);MIcon.initialize=function(a){a=MTools.ifUndefined(a,{}),this._overlay=null,this._anchor=MClass.classOf(a.anchor,MPixel,null),this._isDefaultAnchor=!this._anchor,this._size=MClass.classOf(a.size,MSize,null),this._dom=null,this._$dom=null,this._map=null,this._location=null,this._isShadow=!1,this._zIndex=void 0},MIcon.prototype._initOptions=function(){this._dom||(this._$dom=MElement.create$("span").setCss({position:"absolute",overflow:"hidden"}),this._dom=this._$dom.get(0)),this._size||(this._size=new MSize(32,32)),this.setSize(this._size),this._anchor||(this._anchor=new MPixel(this._size.width/2,this._size.height))},MIcon.prototype._setLocation=function(a){this._location=a;var b=this._map.size(),c=b.width,d=b.height,e=new MPixelBounds(new MPixel(-c,-d),new MPixel(2*c,2*d));this._dom&&(e.contains(a)?this._$dom.setCss({left:a.x-this._anchor.x+"px",top:a.y-this._anchor.y+"px"}).show():this._$dom.hide())},MIcon.prototype.setMap=function(a){this._map=a,this._initOptions()},MIcon.prototype.map=function(){return this._map},MIcon.prototype.paint=function(a){this._overlay&&this._map&&(this._dom.parentNode||(this._isShadow?this._$dom.appendTo(this._map._shadowContainer):this._$dom.appendTo(this._map._markerContainer)),a=a||this._map.toPixel(this._overlay.point()),this._setLocation(a))},MIcon.prototype.overlay=function(){return this._overlay},MIcon.prototype.setOverlay=function(a){a instanceof MOverlay&&(this._overlay=a)},MIcon.prototype.anchor=function(){return this._anchor},MIcon.prototype.setAnchor=function(a){this._anchor=MClass.classOf(a,MPixel,this._anchor),this._isDefaultAnchor=!1,this.visible()&&this._location&&this._setLocation(this._location)},MIcon.prototype.size=function(){return this._size},MIcon.prototype.setSize=function(a){a instanceof MSize&&(this._size=a,this._dom&&this._$dom.setCss({width:this._size.width+"px",height:this._size.height+"px"}))},MIcon.prototype.visible=function(){return this._$dom&&"none"!=this._$dom.css("display")},MIcon.prototype.show=function(){this._dom&&this._$dom.show()},MIcon.prototype.hide=function(){this._dom&&this._$dom.hide()},MIcon.prototype.isShadow=function(){return this._isShadow},MIcon.prototype.toShadow=function(){this._isShadow=!0},MIcon.prototype.zIndex=function(){return this._zIndex},MIcon.prototype.setZIndex=function(a){"number"==typeof a&&(this._zIndex=a,this._$dom.setCss({zIndex:a}))},MIcon.prototype.remove=function(){this._map=null,this._overlay=null,this._$dom.remove()},MIcon.prototype.finalize=function(){this.remove(),MObject.prototype.finalize.apply(this)};var MImgIcon=MClass.create("MImgIcon",MIcon);MImgIcon.initialize=function(a,b){MIcon.initialize.call(this,b),this._url=MTools.ifUndefined(a,""),this._offset=MTools.ifUndefined(b.offset,null),this._touchPixel=void 0},MImgIcon.prototype._initOptions=function(){MIcon.prototype._initOptions.apply(this),""===this._url&&(this._url=this._map.defaultImgIconUrl()),this._offset||(this._offset=new MPixel(0,0)),this._$dom.setCss({backgroundImage:"url("+this._url+")"}),this.setSize(this._size),this.setOffset(this._offset),this._$dom.click(this._onclick,this),this._$dom.mouseover(this._onmouseover,this),this._$dom.mouseout(this._onmouseout,this),this._$dom.touchstart(this._ontouchstart,this),this._$dom.touchend(this._ontouchend,this)},MImgIcon.prototype._ontouchstart=function(a){a.preventDefault(),a.stopPropagation();var b=a.e.touches[0];this._touchPixel=new MPixel(b.pageX,b.pageY)},MImgIcon.prototype._ontouchend=function(a){a.preventDefault(),a.stopPropagation();var b=a.e.changedTouches[0];Math.abs(b.pageX-this._touchPixel.x)<=10&&Math.abs(b.pageY-this._touchPixel.y)<=10&&this._triggerClickEvent()},MImgIcon.prototype._onclick=function(a){a.preventDefault(),a.stopPropagation(),this._triggerClickEvent()},MImgIcon.prototype._triggerClickEvent=function(){MEvent.trigger(this,"click")},MImgIcon.prototype._onmouseover=function(a){a.preventDefault(),a.stopPropagation(),MEvent.trigger(this,"mouseover")},MImgIcon.prototype._onmouseout=function(a){a.preventDefault(),a.stopPropagation(),MEvent.trigger(this,"mouseout")},MImgIcon.prototype.offset=function(){return this._offset},MImgIcon.prototype.setOffset=function(a){a instanceof MPixel&&(this._offset=a,this._$dom.setCss({backgroundPosition:[a.x,"px"," ",a.y,"px"].join("")}))},MImgIcon.prototype.finalize=function(){MEvent.clear(this),MIcon.prototype.finalize.apply(this)},MImgIcon.prototype.url=function(){return this._url},MImgIcon.prototype.setUrl=function(a){this._url=a,this._$dom.setCss({backgroundImage:"url("+a+")"})};var MRichIcon=MClass.create("MRichIcon",MIcon);MRichIcon.initialize=function(a,b){MIcon.initialize.call(this,b),this._content=a},MRichIcon.prototype.getContent=function(){return this._content},MRichIcon.prototype.setContent=function(a){"string"!=typeof a&&!MElement.isElement(a)||this._content===a||(this._content=a)},MRichIcon.prototype.finalize=function(){MEvent.clear(this),MIcon.prototype.finalize.apply(this)},MRichIcon.prototype._initOptions=function(){MIcon.prototype._initOptions.apply(this),"string"==typeof this._content?this._$dom.html(this._content):MElement.isElement(this._content)&&this._$dom.append(this._content),this.setSize(this._size),this._$dom.click(this._onclick,this),this._$dom.mouseover(this._onmouseover,this),this._$dom.mouseout(this._onmouseout,this),this._$dom.touchstart(this._ontouchstart,this),this._$dom.touchend(this._ontouchend,this)},MRichIcon.prototype._ontouchstart=function(a){a.preventDefault(),a.stopPropagation();var b=a.e.touches[0];this._touchPixel=new MPixel(b.pageX,b.pageY)},MRichIcon.prototype._ontouchend=function(a){a.preventDefault(),a.stopPropagation();var b=a.e.changedTouches[0];Math.abs(b.pageX-this._touchPixel.x)<=10&&Math.abs(b.pageY-this._touchPixel.y)<=10&&this._triggerClickEvent()},MRichIcon.prototype._onclick=function(a){a.preventDefault(),a.stopPropagation(),this._triggerClickEvent()},MRichIcon.prototype._triggerClickEvent=function(){MEvent.trigger(this,"click")},MRichIcon.prototype._onmouseover=function(a){a.preventDefault(),a.stopPropagation(),MEvent.trigger(this,"mouseover")},MRichIcon.prototype._onmouseout=function(a){a.preventDefault(),a.stopPropagation(),MEvent.trigger(this,"mouseout")};var MOverlay=MClass.create("MOverlay",MObject);MOverlay.initialize=function(a){this._id=MOverlay.createID(),this._map=null,this._bounds=null,this._initOptions(a)},MOverlay._seqnum=0,MOverlay.createID=function(){return MOverlay._seqnum++},MOverlay.prototype.id=function(){return this._id},MOverlay.prototype.map=function(){return this._map},MOverlay.prototype.setMap=function(a){a instanceof MMap&&(this._map=a)},MOverlay.prototype.bounds=function(){},MOverlay.prototype.paint=function(){},MOverlay.prototype.show=function(){},MOverlay.prototype.hide=function(){},MOverlay.prototype.visible=function(){},MOverlay.prototype.setTop=function(){},MOverlay.prototype.allowedClear=function(){return this._allowedClear},MOverlay.prototype.setAllowedClear=function(a){this._allowedClear="boolean"!=typeof a||a},MOverlay.prototype.remove=function(){this._map.removeOverlay(this,!1,!0),this._map=void 0},MOverlay.prototype.finalize=function(){MObject.prototype.finalize.apply(this,arguments)},MOverlay.prototype.setInfoWindow=function(a){a instanceof MInfoWindowView&&this._infowindow!==a&&(this._infowindow instanceof MInfoWindowView&&this._infowindow.opening()&&(this._infowindow.setOwner(null),this._map&&this._map.closeInfoWindow(this._infowindow)),this._infowindow=a,a.setOwner(this))},MOverlay.prototype.openInfoWindow=function(a){a instanceof MInfoWindowView&&this.setInfoWindow(a),this._infowindow.setMap(this._map)},MOverlay.prototype.closeInfoWindow=function(){this._infowindow instanceof MInfoWindowView&&this._infowindow.close()},MOverlay.prototype._clearBounds=function(){this._bounds=null},MOverlay.prototype._initOptions=function(a){this._allowedClear=MTools.ifTypeOf(a.allowedClear,"boolean",!0),this._infowindow=MTools.ifInstanceOf(a.infowindow,MInfoWindowView,void 0)};var MMarker=MClass.create("MMarker",MOverlay);MMarker.initialize=function(a,b){b=b||{},MOverlay.initialize.call(this,b),this._pt=MTools.ifInstanceOf(a,MPoint,null),this._icon=MTools.ifInstanceOf(b.icon,MIcon,null),this._shadow=MTools.ifInstanceOf(b.shadow,MIcon,null),this._label=MTools.ifInstanceOf(b.label,MLabel,null),this._editable=MTools.ifUndefined(b.editable,!1),this._map=null},MMarker.prototype.paint=function(){if(this._map&&this._pt){var a=this._map.toPixel(this._pt);this._icon.paint(a),this._shadow&&this._shadow.paint(a),this._label&&this._label.paint(a),this._infowindow&&this._infowindow.opening()&&this._infowindow.paint(this._getInfoWindowPosition())}},MMarker.prototype.setMap=function(a){MOverlay.prototype.setMap.call(this,a),this._pt||(this._pt=this._map.center()),this._icon||(this._icon=new MIcon),this._icon.overlay()||this._icon.setOverlay(this),this._icon.setMap(this._map),this._shadow&&(this._shadow.overlay()||this._shadow.setOverlay(this),this._shadow.toShadow(),this._shadow._isDefaultAnchor&&(this._shadow.setAnchor(this._shadow._anchor.clone()),this._shadow._isDefaultAnchor=!0),this._shadow.setMap(this._map)),this._label&&(this._label.overlay()||this._label.setOverlay(this),this._label.setMap(this._map)),this._infowindow instanceof MInfoWindowView&&this._infowindow.setMap(this._map),this._bindIconEvent()},MMarker.prototype.map=function(){return this._map},MMarker.prototype.show=function(){this._icon&&this._icon.show(),this._label&&this._label.show(),this._shadow&&this._shadow.show()},MMarker.prototype.hide=function(){this._icon&&this._icon.hide(),this._label&&this._label.hide(),this._shadow&&this._shadow.hide()},MMarker.prototype.visible=function(){return this._icon&&this._icon.visible()},MMarker.prototype.remove=function(){this._icon instanceof MIcon&&this._icon.remove(),this._shadow instanceof MIcon&&this._shadow.remove(),this._label instanceof MLabel&&this._label.remove(),this._infowindow instanceof MInfoWindowView&&this._map&&this._map.removeInfoWindow(this._infowindow),this._map=null},MMarker.prototype.editable=function(){return this._editable},MMarker.prototype.setEditable=function(a){this._editable=a},MMarker.prototype.icon=function(){return this._icon},MMarker.prototype.setIcon=function(a){a instanceof MIcon&&a!==this._icon&&(this._icon instanceof MIcon&&this._icon.remove(),this._icon=a,this._map&&(this._icon.setOverlay(this),this._icon.setMap(this._map),this._icon.paint(),this._bindIconEvent()))},MMarker.prototype.label=function(){return this._label},MMarker.prototype.setLabel=function(a){a instanceof MLabel&&a!==this._label&&(this._label instanceof MLabel&&this._label.remove(),this._label=a,this._map&&(this._label.setOverlay(this),this._label.setMap(this._map),this._label.paint()))},MMarker.prototype.point=function(){return this._pt},MMarker.prototype.bounds=function(){return this._bounds||(this._bounds=new MBounds(new MPoint(this._pt.lng,this._pt.lat),new MPoint(this._pt.lng,this._pt.lat))),this._bounds},MMarker.prototype.setPoint=function(a){a instanceof MPoint&&!a.equals(this._pt)&&(this._pt=a,this._clearBounds(),this.paint())},MMarker.prototype.openInfoWindow=function(a){MOverlay.prototype.openInfoWindow.apply(this,arguments),this._infowindow.open(this._getInfoWindowPosition())},MMarker.prototype.setTop=function(){if(this._map){var a=this._map.nextMarkerZIndex();this._zIndex=a,this._icon&&this._icon.setZIndex(a),this._shadow&&this._shadow.setZIndex(a),this._label&&this._label.setZIndex(a)}},MMarker.prototype.finalize=function(){MEvent.clear(this),this._icon instanceof MIcon&&this._icon.finalize(),this._shadow instanceof MIcon&&this._shadow.finalize(),this._label instanceof MLabel&&this._label.finalize(),this._infowindow instanceof MInfoWindowView&&this._map&&this._map.removeInfoWindow(this._infowindow),this._infowindow instanceof MInfoWindowView&&this._infowindow.finalize(),MOverlay.prototype.finalize.apply(this)},MMarker.prototype._onclick=function(a){MEvent.trigger(this,"click")},MMarker.prototype._onmouseover=function(a){MEvent.trigger(this,"mouseover")},MMarker.prototype._onmouseout=function(a){MEvent.trigger(this,"mouseout")},MMarker.prototype._getInfoWindowPosition=function(){var a=this._map.toPixel(this._pt);return new MPixel(a.x,a.y-this._icon.size().height)},MMarker.prototype._bindIconEvent=function(){MEvent.bind(this._icon,"click",this._onclick,this),MEvent.bind(this._icon,"mouseover",this._onmouseover,this),MEvent.bind(this._icon,"mouseout",this._onmouseout,this)};var MPanel=MClass.create("MPanel",MObject);MPanel._serialNum=0,MPanel.initialize=function(a){this._createSerialNum(),this._initOptions(a),this._map=void 0,this._dom=void 0,this._$dom=void 0},MPanel.prototype.id=function(){return this._serialNum},MPanel.prototype.map=function(){return this._map},MPanel.prototype.setMap=function(a){a instanceof MMap&&(this._map=a)},MPanel.prototype.zIndex=function(){return this._zIndex},MPanel.prototype.setZIndex=function(a){"number"==typeof a&&(this._zIndex=a,this._dom&&this._$dom.setCss({zIndex:a}))},MPanel.prototype.remove=function(){this._map=void 0,this._$dom.remove()},MPanel.prototype.show=function(){this._dom&&this._$dom.show()},MPanel.prototype.hide=function(){this._dom&&this._$dom.hide()},MPanel.prototype.visible=function(){return this._dom&&"none"===this._$dom.css("display")},MPanel.prototype.allowedClear=function(){return this._allowedClear},MPanel.prototype.setAllowedClear=function(a){this._allowedClear="boolean"!=typeof a||a},MPanel.prototype.finalize=function(){this.remove(),MObject.prototype.finalize.apply(this,arguments)},MPanel.prototype._createSerialNum=function(){this._serialNum="panel"+MPanel._serialNum++},MPanel.prototype._initOptions=function(a){a=a||{},this._zIndex=MTools.ifTypeOf(a.zIndex,"number",0),this._allowedClear=MTools.ifTypeOf(a.allowedClear,"boolean",!0)};var MFloatPanel=MClass.create("MFloatPanel",MPanel);MFloatPanel.initialize=function(a,b){MPanel.initialize.call(this,b),this._content=a,this._size=new MSize(0,0)},MFloatPanel.prototype.setMap=function(a){MPanel.prototype.setMap.apply(this,arguments),this._initStruct(this._content),this._$dom.appendTo(this._map._floatPanelContainer),this._bindMapEvent(),this._setDefaultStyle()},MFloatPanel.prototype.remove=function(){MPanel.prototype.remove.apply(this,arguments),this._bindMapEvent(!0)},MFloatPanel.prototype.position=function(){return this._position},MFloatPanel.prototype.setPosition=function(a){this._position=a,this._setPosition()},MFloatPanel.prototype.marginX=function(){return this._marginX},MFloatPanel.prototype.marginY=function(){return this._marginY},MFloatPanel.prototype.setMargins=function(a,b){"number"==typeof a&&(this._marginX=a),"number"==typeof b&&(this._marginY=b)},MFloatPanel.prototype.setTop=function(){this._map instanceof MMap&&this._$dom.setCss({zIndex:this._map._nextFloatPanelZIndex()})},MFloatPanel.prototype.finalize=function(){MPanel.prototype.finalize.apply(this,arguments)},MFloatPanel.prototype._bindMapEvent=function(a){var b=MEvent[a?"unbind":"bind"];b(this._map,"resize",this._mapResize,this)},MFloatPanel.prototype._mapResize=function(){this._paint()},MFloatPanel.prototype._paint=function(){this._setPosition()},MFloatPanel.prototype._initStruct=function(a){this._dom||(this._$dom=MElement.create$("div"),this._dom=this._$dom.get(0),a&&(MElement.isElement(a)?this._$dom.append(a):this._$dom.html(a)))},MFloatPanel.prototype._setDefaultStyle=function(){this._$dom.setCss({position:"absolute",margin:0,padding:0}),this._size=this._$dom.outerSize(),this._setPosition()},MFloatPanel.prototype._setPosition=function(a){if(this._map){var b=this._position==MPositionType.LEFT_TOP||this._position==MPositionType.RIGHT_TOP,c=this._position==MPositionType.LEFT_BOTTOM||this._position==MPositionType.RIGHT_BOTTOM,d=this._position==MPositionType.LEFT_TOP||this._position==MPositionType.LEFT_BOTTOM,e=this._position==MPositionType.RIGHT_TOP||this._position==MPositionType.RIGHT_BOTTOM,f=a||this._map.size(),g=this._size,h={};b&&(h.top=this._marginY+"px"),d&&(h.left=this._marginX+"px"),c&&(h.top=f.height-g.height-this._marginY+"px"),e&&(h.left=f.width-g.width-this._marginX+"px"),this._$dom.setCss(h)}},MFloatPanel.prototype._initOptions=function(a){a=a||{},MPanel.prototype._initOptions.apply(this,arguments),this._position=MTools.ifUndefined(a.position,MPositionType.LEFT_BOTTOM),this._marginX=MTools.ifUndefined(a.marginX,10),this._marginY=MTools.ifUndefined(a.marginY,10)};var MPinPanel=MClass.create("MPinPanel",MPanel);MPinPanel.initialize=function(a,b,c){MPanel.initialize.call(this,c),this.setPoint(a),this.setContent(b)},MPinPanel.prototype.setMap=function(a){MPanel.prototype.setMap.apply(this,arguments),this._initStruct(),this._$dom.appendTo(this._map._pinPanelContainer),this._bindEvent(),this.paint()},MPinPanel.prototype.remove=function(){MPanel.prototype.remove.apply(this)},MPinPanel.prototype.point=function(){return this._pt},MPinPanel.prototype.setPoint=function(a){this._pt=MTools.ifInstanceOf(a,MPoint,null),this.paint()},MPinPanel.prototype.content=function(){return this._content},MPinPanel.prototype.setContent=function(a){this._content=a,this._setContent()},MPinPanel.prototype.paint=function(){if(this._map instanceof MMap&&this._pt instanceof MPoint){var a=this._map.toPixel(this._pt);this._$dom.setCss({top:a.y+"px",left:a.x+"px"})}},MPinPanel.prototype.setTop=function(){this._map instanceof MMap&&this._$dom.setCss({zIndex:this._map._nextPinPanelZIndex()})},MPinPanel.prototype._initStruct=function(){this._dom||(this._$dom=MElement.create$("div").setCss({position:"absolute",width:0,height:0}),this._dom=this._$dom.get(0),this._setContent())},MPinPanel.prototype._bindEvent=function(a){var b=MEvent[a?"unbind":"bind"];b(this._dom,"click",this._onClick,this),b(this._dom,"mousedown",this._preventEvent,this),b(this._dom,"mouseup",this._preventEvent,this),b(this._dom,"dblclick",this._preventEvent,this),b(this._dom,"touchstart",this._onTouchStart,this),b(this._dom,"touchend",this._onTouchEnd,this)},MPinPanel.prototype._onTouchStart=function(a){a.stopPropagation();var b=a.e.touches[0];this._touchPixel=new MPixel(b.pageX,b.pageY)},MPinPanel.prototype._onTouchEnd=function(a){a.stopPropagation();var b=a.e.changedTouches[0];Math.abs(b.pageX-this._touchPixel.x)<=10&&Math.abs(b.pageY-this._touchPixel.y)<=10&&MEvent.trigger(this,"click")},MPinPanel.prototype._preventEvent=function(a){a.preventDefault(),a.stopPropagation()},MPinPanel.prototype._onClick=function(a){a.stopPropagation(),MEvent.trigger(this,"click")},MPinPanel.prototype._setContent=function(){if(this._dom){var a=this._content;a&&(MElement.isElement(a)?(this._$dom.empty(),this._$dom.append(a)):this._$dom.html(a))}};var MPolyline=MClass.create("MPolyline",MOverlay);MPolyline.initialize=function(a,b){MOverlay.initialize.call(this,b),this._pts=a instanceof Array?a:[],this._visible=!0,this._zIndex=0,this._paintContext=void 0},MPolyline.prototype.paint=function(){MTools.supportSVG?MPolyline.prototype.paint=function(){if(this._map instanceof MMap&&this._visible){for(var a,b,c=this._pts,d=[],e=[],f=0,g=c.length;f<g;f++)b=c[f],this._map.checkLevelGroup(b)&&d.push(this._map.toPixel(b));d=this._clipLine(d);for(var h=0,i=d.length;h<i;h++)a=d[h],e.push(e.length>0?a.x+" "+a.y:"M"+a.x+" "+a.y);this._canvas.setAttr({"stroke-linejoin":"round","stroke-linecap":"round",stroke:this._color,"stroke-width":this._weight,"stroke-opacity":this._opacity,"stroke-dasharray":this._getDashArray().join(" "),fill:"none",d:e.length>0?e.join(" L"):"M0 0"})}}:MPolyline.prototype.paint=function(){if(this._map instanceof MMap&&this._visible){for(var a,b,c,d,e,f,g=this._pts,h=[],i=0,j=g.length;i<j;i++)f=g[i],this._map.checkLevelGroup(f)&&(a=this._map.toPixel(f),b="undefined"==typeof b?a.x:Math.min(a.x,b),c="undefined"==typeof c?a.y:Math.min(a.y,c),d="undefined"==typeof d?a.x:Math.max(a.x,d),e="undefined"==typeof e?a.y:Math.max(a.y,e),h.push(a));if(h=this._clipLine(h),this._range instanceof MPixelBounds){var k=this._range.min,l=this._range.size();MTools.clearCanvas(this._paintContext,k,l)}MTools.paintLine(this._paintContext,h,this.lineStyle()),this._range=new MPixelBounds(new MPixel(b-this._weight,c-this._weight),new MPixel(d+this._weight,e+this._weight))}},this.paint()},MPolyline.prototype.lineStyle=function(){return{strokeStyle:MTools.colorRgb(this._color,this._opacity),lineWidth:this._weight,lineCap:"round",lineJoin:"round"}},MPolyline.prototype.show=function(){this._canvas.show(),this._visible=!0,this.paint()},MPolyline.prototype.hide=function(){this._canvas.hide(),this._visible=!1},MPolyline.prototype.visible=function(){return this._visible},MPolyline.prototype.remove=function(){this._canvas.remove(),this._canvas=null,this._paintContext=null,this._map=null,MEvent.unbind(this._map,"resize",this._onMapResize)},MPolyline.prototype.points=function(){return this._pts},MPolyline.prototype.setPoints=function(a){a instanceof Array&&a.length>1&&(this._pts=a,this._clearBounds(),this.paint())},MPolyline.prototype.color=function(){return this._color},MPolyline.prototype.setColor=function(a){this._setColor(a,!0)},MPolyline.prototype.weight=function(){return this._weight},MPolyline.prototype.setWeight=function(a){"number"==typeof a&&this._weight!==a&&(this._weight=a,this.paint())},MPolyline.prototype.opacity=function(){return this._opacity},MPolyline.prototype.setOpacity=function(a){"number"==typeof a&&this._opacity!==a&&(this._opacity=a,this.paint())},MPolyline.prototype.setMap=function(a){MOverlay.prototype.setMap.call(this,a),this._createCanvas(),MEvent.bind(this._map,"resize",this._onMapResize,this)},MPolyline.prototype.bounds=function(){if(!this._bounds&&this._pts.length){for(var a,b,c,d,e,f,g=0,e=this._pts.length;g<e;g++)f=this._pts[g],g?(a=Math.max(a,f.lng),b=Math.max(b,f.lat),c=Math.min(c,f.lng),d=Math.min(d,f.lat)):(a=c=f.lng,b=d=f.lat);this._bounds=new MBounds(new MPoint(c,d),new MPoint(a,b))}return this._bounds},MPolyline.prototype.setTop=function(){},MPolyline.prototype.finalize=function(){this.remove(),MOverlay.prototype.finalize.apply(this)},MPolyline.prototype._clipLine=function(a){if(a instanceof Array&&this._map){var b,c=this._map.size(),d=c.width,e=c.height,f=new MPixelBounds(new MPixel(-d,-e),new MPixel(2*d,2*e)),g=[];b={px1:a[0].clone(),px2:a[1].clone()},MTools.cohenSutherland(b,f)&&(g=[b.px1,b.px2]);for(var h=1,i=a.length-1;h<i;h++)b={px1:a[h].clone(),px2:a[h+1].clone()},MTools.cohenSutherland(b,f)&&(b.px1!==a[h]&&g.push(b.px1),g.push(b.px2));return g}return null},MPolyline.prototype._onMapResize=function(a,b){MTools.supportSVG?MPolyline.prototype._onMapResize=function(a,b){this.paint()}:MPolyline.prototype._onMapResize=function(a,b){this._canvas.setAttr({width:3*b.width,height:3*b.height}).setCss({top:-b.height+"px",left:-b.width+"px"}),this._paintContext.restore(),this._paintContext.save(),this._paintContext.translate(b.width,b.height)},this._onMapResize(a,b)},MPolyline.prototype._createCanvas=function(){MTools.supportSVG?MPolyline.prototype._createCanvas=function(){this._canvas=MElement.createSVG$("path").appendTo(this._map._svgContainer)}:MPolyline.prototype._createCanvas=function(){var a=this._map.size(),b=a.width,c=a.height;if(this._canvas=MElement.create$("canvas").setAttr({width:3*b,height:3*c}).setCss({position:"absolute",top:-c+"px",left:-b+"px"}).appendTo(this._map._canvasContainer),!this._canvas.get(0).getContext)throw this._paintContext=void 0,new Error("browser does not support the canvas element");this._paintContext=this._canvas.get(0).getContext("2d"),this._paintContext.save(),this._paintContext.translate(b,c)},this._createCanvas()},MPolyline.prototype._getDashArray=function(){var a=[];switch(this._strokeStyle){case MStrokeStyle.DOTTED:a=[.1,3*this._weight];break;case MStrokeStyle.SHORTDOTTED:a=[.1,2*this._weight];break;case MStrokeStyle.DASHED:a=[3*this._weight,3*this._weight];break;case MStrokeStyle.SHORTDASHED:a=[3*this._weight,2*this._weight];break;case MStrokeStyle.LONGDASHED:a=[5*this._weight,2*this._weight];break;case MStrokeStyle.DOTDASHED:a=[4*this._weight,3*this._weight,1,3*this._weight];break;case MStrokeStyle.SHORTDOTDASHED:a=[3*this._weight,2*this._weight,.1,2*this._weight];break;case MStrokeStyle.LONGDOTDASHED:a=[6*this._weight,3*this._weight,1,3*this._weight]}return a},MPolyline.prototype._setColor=function(a,b){a!==this._color&&(this._color=a,b&&this.paint())},MPolyline.prototype._initOptions=function(a){a=a||{},MOverlay.prototype._initOptions.apply(this,arguments),this._strokeStyle=MTools.ifUndefined(a.strokeStyle,MStrokeStyle.SOLID),this._color=MTools.ifUndefined(a.color,"#FF0000"),this._weight=MTools.ifUndefined(a.weight,4),this._opacity=MTools.ifUndefined(a.opacity,.6),this._opacity=MTools.between(this._opacity,0,1,.6),this._editable=MTools.ifUndefined(a.editable,!1)};var MPolygon=MClass.create("MPolygon",MOverlay);MPolygon.initialize=function(a,b){MOverlay.initialize.call(this,b),this._pts=a instanceof Array?a:[],this._visible=!0,this._zIndex=0,this._paintContext=void 0},MPolygon.prototype.paint=function(){MTools.supportSVG?MPolygon.prototype.paint=function(){if(this._map instanceof MMap&&this._visible){for(var a,b,c=this._pts,d=[],e=[],f=0,g=c.length;f<g;f++)b=c[f],this._map.checkLevelGroup(b)&&d.push(this._map.toPixel(b));d=this._clipPolygon(d);for(var h=0,i=d.length;h<i;h++)a=d[h],e.push(e.length>0?a.x+" "+a.y:"M"+a.x+" "+a.y);this._canvas.setAttr({"stroke-linejoin":"round","stroke-linecap":"round",stroke:this._color,"stroke-width":this._weight,"fill-opacity":this._fillOpacity,"stroke-opacity":this._opacity,"stroke-dasharray":this._getDashArray().join(" "),fill:this._fillColor,d:e.length>0?e.join(" L")+" Z":"M0 0"})}}:MPolygon.prototype.paint=function(){if(this._map instanceof MMap&&this._visible){for(var a,b,c,d,e,f,g=this._pts,h=[],i=0,j=g.length;i<j;i++)f=g[i],this._map.checkLevelGroup(f)&&(a=this._map.toPixel(f),b="undefined"==typeof b?a.x:Math.min(a.x,b),c="undefined"==typeof c?a.y:Math.min(a.y,c),d="undefined"==typeof d?a.x:Math.max(a.x,d),e="undefined"==typeof e?a.y:Math.max(a.y,e),h.push(a));if(h=this._clipPolygon(h),this._range instanceof MPixelBounds){var k=this._range.min,l=this._range.size();MTools.clearCanvas(this._paintContext,k,l)}MTools.paintLine(this._paintContext,h,this.lineStyle(),!0),this._range=new MPixelBounds(new MPixel(b-this._weight,c-this._weight),new MPixel(d+this._weight,e+this._weight))}},this.paint()},MPolygon.prototype.lineStyle=function(){return{strokeStyle:MTools.colorRgb(this._color,this._opacity),lineWidth:this._weight,lineCap:"round",lineJoin:"round",fillStyle:MTools.colorRgb(this._fillColor,this._fillOpacity)}},MPolygon.prototype.show=function(){this._canvas.show(),this._visible=!0,this.paint()},MPolygon.prototype.hide=function(){this._canvas.hide(),this._visible=!1},MPolygon.prototype.visible=function(){return this._visible},MPolygon.prototype.remove=function(){this._canvas.remove(),this._canvas=null,this._paintContext=null,this._map=null,MEvent.unbind(this._map,"resize",this._onMapResize)},MPolygon.prototype.points=function(){return this._pts},MPolygon.prototype.setPoints=function(a){a instanceof Array&&a.length>1&&(this._pts=a,this._clearBounds(),this.paint())},MPolygon.prototype.color=function(){return this._color},MPolygon.prototype.setColor=function(a){this._setColor(a,!0)},MPolygon.prototype.fillColor=function(){return this._fillColor},MPolygon.prototype.setFillColor=function(a){this._setFillColor(a,!0)},MPolygon.prototype.weight=function(){return this._weight},MPolygon.prototype.setWeight=function(a){
"number"==typeof a&&this._weight!==a&&(this._weight=a,this.paint())},MPolygon.prototype.opacity=function(){return this._opacity},MPolygon.prototype.setOpacity=function(a){"number"==typeof a&&this._opacity!==a&&(this._opacity=a,this.paint())},MPolygon.prototype.fillOpacity=function(){return this._fillOpacity},MPolygon.prototype.setFillOpacity=function(a){"number"==typeof a&&this._fillOpacity!==a&&(this._fillOpacity=a,this.paint())},MPolygon.prototype.setMap=function(a){MOverlay.prototype.setMap.call(this,a),this._createCanvas(),MEvent.bind(this._map,"resize",this._onMapResize,this)},MPolygon.prototype.bounds=function(){if(!this._bounds&&this._pts.length){for(var a,b,c,d,e,f,g=0,e=this._pts.length;g<e;g++)f=this._pts[g],g?(a=Math.max(a,f.lng),b=Math.max(b,f.lat),c=Math.min(c,f.lng),d=Math.min(d,f.lat)):(a=c=f.lng,b=d=f.lat);this._bounds=new MBounds(new MPoint(c,d),new MPoint(a,b))}return this._bounds},MPolygon.prototype.setTop=function(){},MPolygon.prototype.finalize=function(){this.remove(),MOverlay.prototype.finalize.apply(this)},MPolygon.prototype._clipPolygon=function(a){if(a instanceof Array&&this._map){var b=this._map.size(),c=b.width,d=b.height,e=new MPixelBounds(new MPixel(-c,-d),new MPixel(2*c,2*d));return MTools.sutherlandHodgman(a,e)}return null},MPolygon.prototype._onMapResize=function(a,b){MTools.supportSVG?MPolygon.prototype._onMapResize=function(a,b){this.paint()}:MPolygon.prototype._onMapResize=function(a,b){this._canvas.setAttr({width:3*b.width,height:3*b.height}).setCss({top:-b.height+"px",left:-b.width+"px"}),this._paintContext.restore(),this._paintContext.save(),this._paintContext.translate(b.width,b.height)},this._onMapResize(a,b)},MPolygon.prototype._createCanvas=function(){MTools.supportSVG?MPolygon.prototype._createCanvas=function(){this._canvas=MElement.createSVG$("path").appendTo(this._map._svgContainer)}:MPolygon.prototype._createCanvas=function(){var a=this._map.size(),b=a.width,c=a.height;if(this._canvas=MElement.create$("canvas").setAttr({width:3*b,height:3*c}).setCss({position:"absolute",top:-c+"px",left:-b+"px"}).appendTo(this._map._canvasContainer),!this._canvas.get(0).getContext)throw this._paintContext=void 0,new Error("browser does not support the canvas element");this._paintContext=this._canvas.get(0).getContext("2d"),this._paintContext.save(),this._paintContext.translate(b,c)},this._createCanvas()},MPolygon.prototype._getDashArray=function(){var a=[];switch(this._strokeStyle){case MStrokeStyle.DOTTED:a=[.1,3*this._weight];break;case MStrokeStyle.SHORTDOTTED:a=[.1,2*this._weight];break;case MStrokeStyle.DASHED:a=[3*this._weight,3*this._weight];break;case MStrokeStyle.SHORTDASHED:a=[3*this._weight,2*this._weight];break;case MStrokeStyle.LONGDASHED:a=[5*this._weight,2*this._weight];break;case MStrokeStyle.DOTDASHED:a=[4*this._weight,3*this._weight,1,3*this._weight];break;case MStrokeStyle.SHORTDOTDASHED:a=[3*this._weight,2*this._weight,.1,2*this._weight];break;case MStrokeStyle.LONGDOTDASHED:a=[6*this._weight,3*this._weight,1,3*this._weight]}return a},MPolygon.prototype._setColor=function(a,b){a!==this._color&&(this._color=a,b&&this.paint())},MPolygon.prototype._setFillColor=function(a,b){a!==this._fillColor&&(this._fillColor=a,b&&this.paint())},MPolygon.prototype._initOptions=function(a){a=a||{},MOverlay.prototype._initOptions.apply(this,arguments),this._strokeStyle=MTools.ifUndefined(a.strokeStyle,MStrokeStyle.SOLID),this._color=MTools.ifUndefined(a.color,"#FF0000"),this._fillColor=MTools.ifUndefined(a.fillColor,"#FF0000"),this._weight=MTools.ifUndefined(a.weight,4),this._opacity=MTools.ifUndefined(a.opacity,.6),this._opacity=MTools.between(this._opacity,0,1,.6),this._fillOpacity=MTools.ifUndefined(a.fillOpacity,.4),this._fillOpacity=MTools.between(this._fillOpacity,0,1,.4),this._editable=MTools.ifUndefined(a.editable,!1)};var MCircle=MClass.create("MCircle",MOverlay);MCircle.initialize=function(a,b,c){MOverlay.initialize.apply(this,[c]),this._paintContext=void 0,this._center=void 0,this._radius=void 0,this._visible=!0,this.setCenter(a),this.setRadius(b)},MCircle.prototype.center=function(){return this._center},MCircle.prototype.setCenter=function(a){a instanceof MPoint&&!a.equals(this._center)&&(this._center=a,this._clearBounds(),this.paint())},MCircle.prototype.radius=function(){return this._radius},MCircle.prototype.setRadius=function(a){"number"==typeof a&&a!==this._radius&&(this._radius=a,this._clearBounds(),this.paint())},MCircle.prototype.color=function(){return this._color},MCircle.prototype.setColor=function(a){"string"==typeof a&&a!==this._color&&(this._color=a,this.paint())},MCircle.prototype.fillColor=function(){return this._fillColor},MCircle.prototype.setFillColor=function(a){"string"==typeof a&&a!==this._fillColor&&(this._fillColor=a,this.paint())},MCircle.prototype.weight=function(){return this._weight},MCircle.prototype.setWeight=function(a){"number"==typeof a&&a!==this._weight&&(this._weight=a,this.paint())},MCircle.prototype.opacity=function(){return this._opacity},MCircle.prototype.setOpacity=function(a){"number"==typeof a&&a!==this._opacity&&(this._opacity=a,this.paint())},MCircle.prototype.fillOpacity=function(){return this._fillOpacity},MCircle.prototype.setFillOpacity=function(a){"number"==typeof a&&a!==this._fillOpacity&&(this._fillOpacity=a,this.paint())},MCircle.prototype.setMap=function(a){MOverlay.prototype.setMap.call(this,a),this._createCanvas(),MEvent.bind(this._map,"resize",this._onMapResize,this)},MCircle.prototype.bounds=function(){if(!this._bounds){var a=this._radius/111111,b=new MPoint(this._center.lng,this._center.lat-a),c=this._map.toPixel(this._center),d=this._map.toPixel(b),e=d.y-c.y,f=this._map.toPoint(c.x-e,c.y-e),g=this._map.toPoint(c.x+e,c.y+e);this._bounds=new MBounds(f,g)}return this._bounds},MCircle.prototype.visible=function(){return this._visible},MCircle.prototype.hide=function(){this._canvas.hide(),this._visible=!1},MCircle.prototype.show=function(){this._canvas.show(),this._visible=!0,this.paint()},MCircle.prototype.paint=function(){MTools.supportSVG?MCircle.prototype.paint=function(){if(this._map&&this._center&&this._radius&&this._visible){var a=this._radius/111111,b=new MPoint(this._center.lng,this._center.lat-a),c=this._map.toPixel(this._center),d=this._map.toPixel(b),e=d.y-c.y;this._canvas.setAttr({cx:c.x,cy:c.y,r:e,stroke:this._color,"stroke-width":this._weight,fill:this._fillColor,"stroke-opacity":this._opacity,"fill-opacity":this._fillOpacity})}}:MCircle.prototype.paint=function(){if(this._map&&this._center&&this._radius&&this._paintContext&&this._visible){var a=this._radius/111111,b=new MPoint(this._center.lng,this._center.lat-a),c=this._map.toPixel(this._center),d=this._map.toPixel(b),e=d.y-c.y,f=MTools.colorRgb(this._color,this._opacity),g=MTools.colorRgb(this._fillColor,this._fillOpacity);if(this._range instanceof MPixelBounds){var h=this._range.min,i=this._range.size();MTools.clearCanvas(this._paintContext,h,i)}MTools.paintCircle(this._paintContext,c,e,!0,!0,{strokeStyle:f,lineWidth:this._weight,fillStyle:g}),this._range=new MPixelBounds(new MPixel(c.x-e-this._weight,c.y-e-this._weight),new MPixel(c.x+e+this._weight,c.y+e+this._weight))}},this.paint()},MCircle.prototype.borderStyle=function(){return{strokeStyle:MTools.colorRgb(this._color,this._opacity),lineWidth:this._weight}},MCircle.prototype.fillStyle=function(){return{fillStyle:MTools.colorRgb(this._fillColor,this._fillOpacity)}},MCircle.prototype.setTop=function(){},MCircle.prototype.remove=function(){this._canvas.remove(),this._canvas=null,this._paintContext=null,this._map=null,MEvent.unbind(this._map,"resize",this._onMapResize)},MCircle.prototype.finalize=function(){this.remove(),MOverlay.prototype.finalize.apply(this)},MCircle.prototype._onMapResize=function(a,b){MTools.supportSVG?MCircle.prototype._onMapResize=function(a,b){this.paint()}:MCircle.prototype._onMapResize=function(a,b){this._canvas.setAttr({width:3*b.width,height:3*b.height}).setCss({top:-b.height+"px",left:-b.width+"px"}),this._paintContext.restore(),this._paintContext.save(),this._paintContext.translate(b.width,b.height)},this._onMapResize(a,b)},MCircle.prototype._createCanvas=function(){MTools.supportSVG?MCircle.prototype._createCanvas=function(){this._canvas=MElement.createSVG$("circle").appendTo(this._map._svgContainer)}:MCircle.prototype._createCanvas=function(){var a=this._map.size(),b=a.width,c=a.height;if(this._canvas=MElement.create$("canvas").setAttr({width:3*b,height:3*c}).setCss({position:"absolute",top:-c+"px",left:-b+"px"}).appendTo(this._map._canvasContainer),!this._canvas.get(0).getContext)throw this._paintContext=void 0,new Error("browser does not support the canvas element");this._paintContext=this._canvas.get(0).getContext("2d"),this._paintContext.save(),this._paintContext.translate(b,c)},this._createCanvas()},MCircle.prototype._initOptions=function(a){a=a||{},MOverlay.prototype._initOptions.apply(this,arguments),this._color=MTools.ifUndefined(a.color,"#F00"),this._fillColor=MTools.ifUndefined(a.fillColor,"#F00"),this._weight=MTools.ifUndefined(a.weight,2),this._opacity=MTools.ifUndefined(a.opacity,.6),this._fillOpacity=MTools.ifUndefined(a.fillOpacity,.3),this._editable=MTools.ifUndefined(a.editable,!1)};var MInfoWindowView=MClass.create("MInfoWindowView",MObject);MInfoWindowView.initialize=function(a,b){this._initOptions(b),this._owner=null,this._map=null,this._dom=void 0,this._opening=!1,this._content=a,this._position=null,this._size=null,this._serialNum=null},MInfoWindowView._serialNum=0,MInfoWindowView.prototype.id=function(){return this._serialNum||this._createSerialNum(),this._serialNum},MInfoWindowView.prototype.dom=function(){return this._dom},MInfoWindowView.prototype.owner=function(){return this._owner},MInfoWindowView.prototype.setOwner=function(a){this._owner=a},MInfoWindowView.prototype.map=function(){return this._map},MInfoWindowView.prototype.setMap=function(a){a instanceof MMap&&(this._map=a)},MInfoWindowView.prototype.opening=function(){return this._opening},MInfoWindowView.prototype.open=function(a){this.setPosition(a)},MInfoWindowView.prototype.close=function(){},MInfoWindowView.prototype.content=function(){return this._content},MInfoWindowView.prototype.setContent=function(a){this._content=a},MInfoWindowView.prototype.position=function(){return this._position},MInfoWindowView.prototype.setPosition=function(a){a instanceof MPixel&&!a.equals(this._position)&&(this._position=a)},MInfoWindowView.prototype.paint=function(a){this.setPosition(a)},MInfoWindowView.prototype.size=function(){return this._size},MInfoWindowView.prototype.resize=function(a){a instanceof MSize&&!a.equals(this._size)&&(this._size=a)},MInfoWindowView.prototype.remove=function(){},MInfoWindowView.prototype.finalize=function(){this.remove(),MObject.prototype.finalize.apply(this,arguments)},MInfoWindowView.prototype._createSerialNum=function(){this._serialNum="iw"+MInfoWindowView._serialNum++},MInfoWindowView.prototype._initOptions=function(a){};var MInfoWindow=MClass.create("MInfoWindow",MInfoWindowView);MInfoWindow.initialize=function(a,b){MInfoWindowView.initialize.apply(this,arguments),this._mapPadding=10,this._dis=2,this._cPadding={top:10,right:10,bottom:10,left:10},this._borderRadius=5,this._cBorder=1,this._arrowSize=new MSize(15,8)},MInfoWindow.prototype.open=function(a){this._dom?this._$dom.show():(this._initStruct(),this._applyContent(),this._map.addInfoWindow(this),this._drawArrow()),this.setPosition(a||this._position),this._updateUI(!0),this._opening=!0,MEvent.trigger(this,"opened")},MInfoWindow.prototype.close=function(a){a=MTools.ifUndefined(a,!0),this._$dom.hide(),this._opening=!1,!this._owner&&a&&this.finalize(),MEvent.trigger(this,"closed")},MInfoWindow.prototype.setContent=function(a){MInfoWindowView.prototype.setContent.apply(this,arguments),this._applyContent()},MInfoWindow.prototype.setPosition=function(a){if(a instanceof MPixel){var b=this._map.size(),c=b.width,d=b.height,e=new MPixelBounds(new MPixel(-c,-d),new MPixel(2*c,2*d));e.contains(a)?(MInfoWindowView.prototype.setPosition.apply(this,arguments),!arguments[1]&&(this._point=this._map.toPoint(a)),this._applyPosition()):this._$dom.hide()}},MInfoWindow.prototype.paint=function(a){a=a instanceof MPixel?a:this._map.toPixel(this._point),this.setPosition(a,!0),this._map._autoAdjustInfoWindowPosition&&this._updateUI()},MInfoWindow.prototype.resize=function(a){try{a instanceof MSize&&(MInfoWindowView.prototype.resize.call(this,a),this._cContainer.setCss({whiteSpace:"normal",width:a.width>0?a.width-this._cPadding.right-this._cPadding.left-2*this._cBorder+"px":"auto",height:a.height>0?a.height-this._cPadding.top-this._cPadding.bottom-2*this._cBorder+"px":"auto"}),this._updateUI(!0))}catch(a){alert(a.message)}},MInfoWindow.prototype.remove=function(){this._bindEvent(!0),MTools.removeNode(this._dom),this._dom=null,this._owner=null,this._map=null},MInfoWindow.prototype.finalize=function(){this.remove(),MInfoWindowView.prototype.finalize.apply(this,arguments)},MInfoWindow.prototype._initOptions=function(a){a=a||{},this._size=MTools.ifUndefined(a.size,void 0)},MInfoWindow.prototype._initStruct=function(){var a=this._size;this._$dom=MElement.create$("div").setCss({position:"absolute",width:0,height:0}),this._dom=this._$dom.get(0),this._cContainer=MElement.create$("div").setAttr({style:"background:#DEDEDE;background:-moz-linear-gradient(top, #FEFEFE, #DEDEDE);background:-webkit-linear-gradient(top, #FEFEFE, #DEDEDE);background:-webkit-gradient(linear, 0 0, 0 100%, from(#FEFEFE), to(#DEDEDE));"+(this._map._enabledHighResolution?"text-shadow:2px 2px #FFF;box-shadow:6px 6px 5px #999;-webkit-box-shadow:6px 6px 5px #999;":"text-shadow:1px 1px #FFF;box-shadow:3px 3px 5px #999;-webkit-box-shadow:3px 3px 5px #999;")}).setCss({position:"absolute",whiteSpace:"nowrap",border:(this._map._enabledHighResolution?2*this._cBorder:this._cBorder)+"px solid #666",padding:this._cPadding.top+"px "+this._cPadding.right+"px "+this._cPadding.bottom+"px "+this._cPadding.left+"px",borderRadius:this._borderRadius+"px",fontSize:this._map._enabledHighResolution?"24px":"12px"}).appendTo(this._dom),this._cContainer.addClass("MInfoWindow"),MClass.classOf(a,MSize)&&this._cContainer.setCss({width:a.width>0?a.width-this._cPadding.right-this._cPadding.left-2*this._cBorder+"px":"auto",height:a.height>0?a.height-this._cPadding.top-this._cPadding.bottom-2*this._cBorder+"px":"auto"}),this._arrow=MElement.create$("canvas").setAttr({width:this._map._enabledHighResolution?2*this._arrowSize.width:this._arrowSize.width,height:this._map._enabledHighResolution?2*this._arrowSize.height:this._arrowSize.height}).setCss({position:"absolute"}).appendTo(this._dom),this._bindEvent()},MInfoWindow.prototype._bindEvent=function(a){var b=a?MEvent.unbind:MEvent.bind;b(this._dom,"click",this._stopPropagation),b(this._dom,"dblclick",this._stopPropagation),b(this._dom,"touchstart",this._stopPropagation),this._map&&b(this._map,"click",this._mapClick,this)},MInfoWindow.prototype._stopPropagation=function(a){a.stopPropagation()},MInfoWindow.prototype._mapClick=function(a){this._map._closeInfoWindowOnMapClick&&this.close(!1)},MInfoWindow.prototype._applyContent=function(){this._cContainer&&(MElement.isElement(this._content)?this._cContainer.empty().append(this._content):"string"==typeof this._content&&this._cContainer.html(this._content))},MInfoWindow.prototype._applyPosition=function(){this._$dom.setCss({top:this._position.y-this._dis+"px",left:this._position.x+"px"}).show()},MInfoWindow.prototype._updateUI=function(a){var b=this._cContainer.outerSize(),c=this._map.size(),d=new MSize(c.width-2*this._mapPadding,c.height-2*this._mapPadding);if(d.width<b.width)this.resize(new MSize(d.width-5,0));else{var e={left:-(b.width/2)+"px",top:-b.height-this._arrowSize.height+(this._map._enabledHighResolution?2*this._cBorder:this._cBorder)+"px"},f=this._owner?this._owner.icon().size():new MSize(0,0),g=this._map.bounds();(this._position.x<0||this._position.x>c.width||this._position.y+this._dis+f.height<0||this._position.y>c.height)&&a&&this._map.setCenter(this._point);var h,i,j,k,l,m,n=this._position.x-this._mapPadding,o=c.width-this._position.x-this._mapPadding,p=(this._position.y-this._arrowSize.height-b.height-this._dis,c.height-this._position.y-this._dis-f.height-this._mapPadding,b.width/2),q=-p,r=5+this._arrowSize.width/2+this._cPadding.left,s=5+this._arrowSize.width/2+this._cPadding.right;n<p&&this._map._autoAdjustInfoWindowPosition&&(q=-(n<r?r:n),e.left=q+"px"),o<p&&this._map._autoAdjustInfoWindowPosition&&(q=-(o<s?2*p-s:2*p-o),e.left=q+"px"),h=this._position.x+q-this._mapPadding,i=this._position.y+f.height+this._mapPadding,j=this._position.x+b.width+q+this._mapPadding,k=this._position.y-this._arrowSize.height-b.height-this._dis-this._mapPadding,l=this._map.toPoint(h,i),m=this._map.toPoint(j,k),g.contains(l)&&g.contains(m)||!a||!this._map._panMapOnOpenInfoWindow||this._map.intoView(new MBounds(l,m)),this._cContainer.setCss(e),this._arrow.setCss({left:-Math.round((this._map._enabledHighResolution?2*this._arrowSize.width:this._arrowSize.width)/2)+"px",top:-this._arrowSize.height+"px"})}},MInfoWindow.prototype._drawArrow=function(){var a=this._arrow.get(0).getContext("2d"),b=parseInt(this._arrow.css("width")),c=parseInt(this._arrow.css("height"));a.save(),a.lineWidth=this._map._enabledHighResolution?2*this._cBorder:this._cBorder,a.strokeStyle="#000",a.beginPath(),a.moveTo(0,0),a.lineTo(Math.round(b/2),c),a.lineTo(b,0),a.stroke(),a.fillStyle="#DEDEDE",a.fill(),a.restore()};var MLabel=MClass.create("MLabel",MObject);MLabel.initialize=function(a,b){this._initOptions(b),this._content=a,this._overlay=null,this._dom=null,this._map=null,this._visible=!0},MLabel.prototype.map=function(){return this._map},MLabel.prototype.setMap=function(a){a instanceof MMap&&(this._map=a,this._buildDom())},MLabel.prototype.overlay=function(){return this._overlay},MLabel.prototype.setOverlay=function(a){a instanceof MOverlay&&(this._overlay=a)},MLabel.prototype.anchor=function(){return this._anchor},MLabel.prototype.setAnchor=function(a){a instanceof MPixel&&a.equals(this._anchor)},MLabel.prototype.paint=function(a){this._overlay&&this._map&&(this._dom.parentNode||this._$dom.appendTo(this._map._markerContainer),a=a||this._map.toPixel(this._overlay.point()),this._setLocation(a))},MLabel.prototype.content=function(){return this._text},MLabel.prototype.setContent=function(a){"string"==typeof a&&a!==this._text&&(this._text=a,this._dom&&this._$dom.html(a))},MLabel.prototype.visible=function(){return this._map&&this._dom&&this._visible},MLabel.prototype.show=function(){this.visible()||(this._visible=!0,this._dom&&this._map&&this._$dom.show())},MLabel.prototype.hide=function(){this.visible()&&(this._visible=!1,this._dom&&this._map&&this._$dom.hide())},MLabel.prototype.setZIndex=function(a){this._visible()&&"number"==typeof a&&this._$dom.setCss({zIndex:a})},MLabel.prototype.remove=function(){this._map&&this._dom&&(this._$dom.remove(),this._map=null)},MLabel.prototype.finalize=function(){this.remove(),MObject.prototype.finalize.apply(this)},MLabel.prototype._bindEvent=function(a){var b=a?MEvent.unbind:MEvent.bind;b(this._dom,"click",this._preventEvent,this),b(this._dom,"mousedown",this._preventEvent,this),b(this._dom,"mouseup",this._preventEvent,this),b(this._dom,"dblclick",this._preventEvent,this),b(this._dom,"touchstart",this._preventEvent,this),b(this._dom,"touchend",this._preventEvent,this)},MLabel.prototype._preventEvent=function(a){a.preventDefault(),a.stopPropagation()},MLabel.prototype._setLocation=function(a){var b=this._map.size(),c=b.width,d=b.height,e=new MPixelBounds(new MPixel(-c,-d),new MPixel(2*c,2*d));this._dom&&(e.contains(a)?this._$dom.setCss({left:a.x+this._anchor.x+"px",top:a.y+this._anchor.y+"px"}).show():this._$dom.hide())},MLabel.prototype._buildDom=function(){this._dom||(this._$dom=MElement.create$("div").setCss({position:"absolute",border:"none",whiteSpace:"nowrap"}).html(this._content),this._dom=this._$dom.get(0),this._bindEvent())},MLabel.prototype._initOptions=function(a){a=a||{},this._anchor=MTools.ifInstanceOf(a.anchor,MPixel,new MPixel(0,0))};var MCopyright=MClass.create("MCopyright",MFloatPanel);MCopyright.initialize=function(a){MFloatPanel.initialize.call(this,a.content,a),this._position=a.position},MCopyright.prototype._setDefaultStyle=function(){this._$dom.setCss({zIndex:1}),MFloatPanel.prototype._setDefaultStyle.call(this)},MCopyright.prototype._mapResize=function(a,b){this._setPosition(b)},MCopyright.prototype._setPosition=function(a){if(this._position===MPositionType.CENTER_BOTTOM){if(this._map){var b=a||this._map.size(),c=this._size,d={top:b.height-c.height-this._marginY+"px",left:Math.floor((b.width-c.width)/2)+"px"};this._$dom.setCss(d)}}else MFloatPanel.prototype._setPosition.call(this,a)},MCopyright.prototype._initOptions=function(a){a=a||{},a.allowedClear=!1,a.marginX=0,a.marginY=0,a.position=MTools.ifUndefined(a.position,MPositionType.CENTER_BOTTOM),MFloatPanel.prototype._initOptions.call(this,a)};var MStandardControl=MClass.create("MStandardControl",MFloatPanel);MStandardControl.initialize=function(a){this._min=!1,this._max=!1,this._geo=!1,MFloatPanel.initialize.call(this,null,a),this._setButtonSize()},MStandardControl.prototype.setMap=function(){MFloatPanel.prototype.setMap.apply(this,arguments),this._bindEvent()},MStandardControl.prototype.remove=function(){this._bindEvent(!0),MFloatPanel.prototype.remove.apply(this,arguments),this._map=null},MStandardControl.prototype.setMargins=function(a,b){MFloatPanel.prototype.setMargins.call(this,a,b),this._setPosition()},MStandardControl.prototype.finalize=function(){this._bindEvent(!0),this._$dom.remove(),MFloatPanel.prototype.finalize.apply(this,arguments)},MStandardControl.prototype._initStruct=function(){this._$dom=MElement.create$("div"),this._dom=this._$dom.get(0),this._geoBtn=this._createButton(),this._geoCtx=this._geoBtn.get(0).getContext("2d"),this._zoomInBtn=this._createButton(),this._zoomInCtx=this._zoomInBtn.get(0).getContext("2d"),this._zoomOutBtn=this._createButton(),this._zoomOutCtx=this._zoomOutBtn.get(0).getContext("2d"),this._btns=MElement.$$([this._geoBtn,this._zoomInBtn,this._zoomOutBtn])},MStandardControl.prototype._drawBackground=function(a,b){var c=a.canvas.width,d=a.canvas.height;a.save(),a.translate(Math.round(c/2),Math.round(d/2)),MTools.paintCircle(a,new MPixel(0,0),Math.round(Math.min(c,d)/2),!0,!1,{fillStyle:b}),a.restore()},MStandardControl.prototype._drawLocation=function(a,b,c){var d=a.canvas.width,e=a.canvas.height,f=Math.round(d/2),g=Math.round(e/2);this._drawBackground(a,c),a.save(),a.translate(f,g),MTools.paintLines(a,[[new MPixel(0,.37*-e),new MPixel(0,.37*e)],[new MPixel(.37*-d,0),new MPixel(.37*d,0)]],{lineCap:"round",strokeStyle:b,lineWidth:Math.round(d/7)}),MTools.paintCircle(a,new MPixel(0,0),Math.round(.35*d),!0,!1,{fillStyle:b}),MTools.paintCircle(a,new MPixel(0,0),Math.round(.25*d),!0,!1,{fillStyle:c}),MTools.paintCircle(a,new MPixel(0,0),Math.round(.18*d),!0,!1,{fillStyle:b}),a.restore()},MStandardControl.prototype._drawZoomIn=function(a,b,c){var d=a.canvas.width,e=a.canvas.height,f=Math.round(d/2),g=Math.round(e/2);this._drawBackground(a,c),MTools.paintCircle(a,new MPixel(f,g),Math.round(.36*Math.min(d,e)),!1,!0,{lineWidth:Math.round(d/10),strokeStyle:b}),a.save(),a.translate(f,g),MTools.paintLines(a,[[new MPixel(.2*-d,0),new MPixel(.2*d,0)],[new MPixel(0,.2*-e),new MPixel(0,.2*e)]],{lineCap:"round",lineWidth:Math.round(.12*d),strokeStyle:b}),a.restore()},MStandardControl.prototype._drawZoomOut=function(a,b,c){var d=a.canvas.width,e=a.canvas.height,f=Math.round(d/2),g=Math.round(e/2);this._drawBackground(a,c),MTools.paintCircle(a,new MPixel(f,g),Math.round(.36*Math.min(d,e)),!1,!0,{lineWidth:Math.round(d/10),strokeStyle:b}),a.save(),a.translate(f,g),MTools.paintLine(a,[new MPixel(.2*-d,0),new MPixel(.2*d,0)],{lineCap:"round",lineWidth:Math.round(.12*d),strokeStyle:b}),a.restore()},MStandardControl.prototype._setButtonState=function(a,b){var c,d,e="#5F6D93",f="#FFFFFF";switch(a){case 0:c=this._drawLocation,d=this._geoCtx;break;case 1:c=this._drawZoomIn,d=this._zoomInCtx;break;case 2:c=this._drawZoomOut,d=this._zoomOutCtx}switch(b){case 1:e="#FFFFFF",f="#0066CC";break;case 2:e="#CCCCCC"}MTools.clearCanvas(d),c.call(this,d,e,f)},MStandardControl.prototype._setDefaultStyle=function(){this._zoomInBtn.setCss({marginBottom:"10px"}),this._setButtonState(1,0),this._setButtonState(2,0),this._geoBtn.setCss({marginBottom:"10px"}),this._setButtonState(0,0),this._$dom.setCss({position:"absolute",width:this._btnSize,margin:0,padding:0,opacity:.8}),this._applyOptions(),this._size=this._$dom.outerSize(),this._setPosition()},MStandardControl.prototype._applyOptions=function(){var a=MElement.$$([this._zoomInBtn,this._zoomOutBtn]);this._btnLocation&&navigator.geolocation?this._geoBtn.show():this._geoBtn.hide(),this._btnZoom?a.show():a.hide()},MStandardControl.prototype._bindEvent=function(a){if(this._map){var b=a?"unbind":"bind";MTools.supportTouch()?(this._zoomInBtn[b]("touchend",this._zoomInClick,this)[b]("touchstart",this._zoomInMousedown,this),this._zoomOutBtn[b]("touchend",this._zoomOutClick,this)[b]("touchstart",this._zoomOutMousedown,this),this._geoBtn[b]("touchend",this._locationClick,this)[b]("touchstart",this._geoMousedown,this)):(this._zoomInBtn[b]("click",this._zoomInClick,this)[b]("mousedown",this._zoomInMousedown,this)[b]("mouseup",this._zoomInMouseup,this),this._zoomOutBtn[b]("click",this._zoomOutClick,this)[b]("mousedown",this._zoomOutMousedown,this)[b]("mouseup",this._zoomOutMouseup,this),this._geoBtn[b]("click",this._locationClick,this)[b]("mousedown",this._geoMousedown,this)[b]("mouseup",this._geoMouseup,this)),MEvent[b](this._map,"zoom_changed",this._mapZoomed,this),MEvent[b](this._map,"zoomRange_change",this._mapZoomRangeChanged,this),MEvent[b](this._map,"geo_start",this._mapStartLocation,this),MEvent[b](this._map,"geo_success",this._mapLocationed,this),MEvent[b](this._map,"geo_failed",this._mapLocationed,this)}},MStandardControl.prototype._zoomInMousedown=function(a){a.preventDefault(),a.stopPropagation(),!this._max&&this._setButtonState(1,1)},MStandardControl.prototype._zoomInMouseup=function(a){a.preventDefault(),a.stopPropagation()},MStandardControl.prototype._zoomOutMousedown=function(a){a.preventDefault(),a.stopPropagation(),!this._min&&this._setButtonState(2,1)},MStandardControl.prototype._zoomOutMouseup=function(a){a.preventDefault(),a.stopPropagation()},MStandardControl.prototype._geoMousedown=function(a){a.preventDefault(),a.stopPropagation(),!this._geo&&this._setButtonState(0,1)},MStandardControl.prototype._geoMouseup=function(a){a.preventDefault(),a.stopPropagation()},MStandardControl.prototype._zoomInClick=function(a){a.preventDefault(),a.stopPropagation(),this._max||(this._setButtonState(1,0),this._map.zoomIn())},MStandardControl.prototype._zoomOutClick=function(a){a.preventDefault(),a.stopPropagation(),this._min||(this._setButtonState(2,0),this._map.zoomOut())},MStandardControl.prototype._locationClick=function(a){a.preventDefault(),a.stopPropagation(),this._geo||(this._setButtonState(0,2),this._map.watchPosition(),this._geo=!0)},MStandardControl.prototype._mapStartLocation=function(a){this._setButtonState(0,2),this._geo=!0},MStandardControl.prototype._mapLocationed=function(a){this._setButtonState(0,0),this._geo=!1},MStandardControl.prototype._mapResize=function(a,b){this._setPosition(b)},MStandardControl.prototype._mapZoomed=function(a,b){this._setButton(b,this._map.getMinZoom(),this._map.getMaxZoom())},MStandardControl.prototype._mapZoomRangeChanged=function(a,b,c){this._setButton(this._map.zoom(),b,c)},MStandardControl.prototype._setButton=function(a,b,c){a>=c?(this._setButtonState(1,2),this._max=!0):(this._setButtonState(1,0),this._max=!1),a<=b?(this._setButtonState(2,2),this._min=!0):(this._setButtonState(2,0),this._min=!1)},MStandardControl.prototype._createButton=function(){var a=this._btnSize.toString();return MElement.create$("canvas").setCss({background:"none",margin:0,padding:0,cursor:"pointer"}).setAttr({width:a,height:a}).appendTo(this._$dom)},MStandardControl.prototype._setButtonSize=function(){if(MTools.browser.iphone||MTools.browser.ipad)this._btnSize=Math.round(Math.min(screen.width,screen.height)/8/(screen.width/(screen.width>=768?450:320))*MTools.getViewportScale());else{var a=Math.min(window.innerWidth,window.innerHeight),b=Math.max(window.innerWidth,window.innerHeight);this._btnSize=Math.round(a/8/(a/(b>800?450:a)))}},MStandardControl.prototype._initOptions=function(a){a=a||{},a.allowedClear=!1,MFloatPanel.prototype._initOptions.call(this,a),this._btnLocation=MTools.ifUndefined(a.btnLocation,!0),this._btnZoom=MTools.ifUndefined(a.btnZoom,!0)};var MLayer=MClass.create("MLayer",MObject);MLayer.initialize=function(a){this._tiles={},this._map=null,this._visible=!0,this._snMin=null,this._snMax=null,this._pHead=null,this._pBody=null,this._dsnMin=null,this._dsnMax=null,this._dpHead=null,this._dpBody=null,this._initOptions(a),this._initServerNum()},MLayer.prototype.map=function(){return this._map},MLayer.prototype.setMap=function(a){a instanceof MMap&&(this._map=a,this._$dom=MElement.create$("div").setCss({position:"absolute",padding:0,margin:0,zIndex:this._zIndex}),this.dom=this._$dom.get(0),this._setSize(a.size()),this._listenMapEvent(),this._loadTiles())},MLayer.prototype.visible=function(){return this._visible},MLayer.prototype.show=function(){this._visible||(this._visible=!0,this._map._renderMap())},MLayer.prototype.hide=function(){this._visible&&(this._visible=!1,this._map._renderMap())},MLayer.prototype.refresh=function(){this._clearTiles(),this._loadTiles()},MLayer.prototype.tiles=function(){return this._tiles},MLayer.prototype.zIndex=function(){return this._zIndex},MLayer.prototype.enabledTile=function(){return this._enabledTile},MLayer.prototype.remove=function(){this._clearTiles(),this._map&&(this._map._layersContainer.get(0).removeChild(this.dom),this._listenMapEvent(!1),this._map=void 0)},MLayer.prototype.setTileServer=function(a,b,c){this._tileServer=a||this._tileServer,this._tileFormat=b||this._tileFormat,this._tilePreprocessor=c||this._tilePreprocessor,this._initServerNum(),this.refresh()},MLayer.prototype.finalize=function(){this.remove(),MObject.prototype.finalize.apply(this,arguments)},MLayer.prototype._setSize=function(a){this._$dom.setCss({width:a.width+"px",height:a.height+"px"})},MLayer.prototype._loadTiles=function(){if(this._map&&this._enabledTile){var a=this._map.zoom();if(a<=this._maxZoom&&a>=this._minZoom)for(var b=this._map.grids(),c=0,d=b.length;c<d;c++)this._addTile(b[c],MGridEventAction.NORMAL)}},MLayer.prototype._clearTiles=function(){for(var a in this._tiles)this._tiles[a].finalize(),this._tiles[a]=null,delete this._tiles[a]},MLayer.prototype._listenMapEvent=function(a){a="boolean"!=typeof a||a;var b=MEvent[a?"bind":"unbind"];b(this._map,"grid_created",this._gridCreated,this),b(this._map,"grid_removed",this._gridRemoved,this),b(this._map,"grid_updated",this._updateTile,this),b(this._map,"click",this._mapClick,this),b(this._map,"resize",this._mapResize,this)},MLayer.prototype._mapResize=function(a,b){this._setSize(b)},MLayer.prototype._updateTile=function(a,b){var c=b.id(),d=this._map.zoom();d<=this._maxZoom&&d>=this._minZoom&&(this._tiles[c]?this._tiles[c].update():this._addTile(b))},MLayer.prototype._mapClick=function(a){},MLayer.prototype._gridCreated=function(a,b,c){this._enabledTile&&this._createTile(b,c),this._enabledData&&this._createData(b,c)},MLayer.prototype._gridRemoved=function(a,b){this._enabledTile&&this._removeTile(b)},MLayer.prototype._removeTile=function(a){var b=a.id(),c=this._tiles[b];c&&(c.finalize(),c=null,delete this._tiles[b])},MLayer.prototype._createTile=function(a,b){if(this._enabledTile){var c=a.zoom();c<=this._maxZoom&&c>=this._minZoom&&(this._autoLoadOfPan||b!=MGridEventAction.DRAGGING)&&this._addTile(a,b)}},MLayer.prototype._addTile=function(a,b){var c=this._buildTileUrl(a);if(c){
var d=new MImgTile(c,this,a);d._action=b,this._tiles[a.id()]=d,MEvent.bind(d,"complete",this._tileComplete,this)}},MLayer.prototype._tileComplete=function(a){var b=MElement.$(a.target.res());a.target._action===MGridEventAction.NORMAL&&(b.style.opacity=MTools.browser.firefox?1:0,b.className="mapTile",b.addEventListener("webkitAnimationEnd",function(){this.style.opacity=1},!1),b.addEventListener("animationend",function(){this.style.opacity=1},!1)),this.dom.appendChild(b)},MLayer.prototype._buildTileUrl=function(a){if(a instanceof MGrid&&this._enabledTile){if(this._tilePreprocessor)return this._tilePreprocessor.call(this._tpContext?this._tpContext:window,a);var b=MTilePathType.RELATIVE,c=a.zoom(),d=this._tileServer;if(this._pHead&&(d=this._pHead+this._getServerNumber(a)+this._pBody),b==MTilePathType.ABSOLUTE)return d+"?l="+c+"&x="+a.a_grid_x()+"&y="+a.a_grid_y();if(b==MTilePathType.RELATIVE)return this._map.isEnabledDynamicMap()?d+this._getDynamicMapUrl(a):this._map.isEnabledHighResolution()?d+this._getHighResolutionUrl(a):d+this._getLowResolutionUrl(a)}return null},MLayer.prototype._getHighResolutionUrl=function(a){var b=a.zoom(),c=this._map.isEnabledHighResolution()?b:b-1,d=Math.floor(1e5*this._map.lngStep()),e=Math.floor(1e5*this._map.latStep()),f=Math.floor(1e5*a.point().lng);f>18e6&&(f=-36e6+f);var g=Math.floor(1e5*a.point().lat),h=Math.floor(f/d),i=Math.floor(g/e);if(b>=5){var j=1e3,k=800,l=Math.floor(100*f/j/1e5),m=Math.floor(100*g/k/1e5);if(c+="/"+l+"_"+m,b>=8){j=100,k=80;var n=Math.floor(100*f/j/1e5%10),o=Math.floor(100*g/k/1e5%10);if(c+="/"+n+"_"+o,b>=11){j=10,k=8;var p=Math.floor(100*f/j/1e5%10),q=Math.floor(100*g/k/1e5%10);c+="/"+p+"_"+q}}h=Math.floor(h%(1e5*j/d/100)),i=Math.floor(i%(1e5*k/e/100))}return c+="/"+h+"_"+i,c+"."+this._tileFormat+MConfig.imgVersion},MLayer.prototype._getLowResolutionUrl=function(a){var b=a.area_x(),c=a.area_y(),d=a.r_grid_x(),e=a.r_grid_y(),f=a.zoom();return 14==f?MConfig.mapDirs[f]+"/"+b+"/"+b+"_"+c+"/"+d+"_"+e+"."+this._tileFormat+MConfig.imgVersion:MConfig.mapDirs[f]+"/"+b+"_"+c+"/"+d+"_"+e+"."+this._tileFormat+MConfig.imgVersion},MLayer.prototype._getServerNumber=function(a,b){b=isNaN(b)?0:b;var c=a.a_grid_x()%(this[b?"_dsnMax":"_snMax"]+2)-1;return c>=0?c:""},MLayer.prototype._initServerNum=function(){if(this._enabledTile){var a=this._tileServer.match(new RegExp("(.*)(\\[(\\d+)-(\\d+)\\])(.*)"));a?(this._pHead=a[1],this._pBody=a[5],this._snMin=parseInt(a[3]),this._snMax=parseInt(a[4])):(this._pHead="",this._pBody="",this._snMin="",this._snMax="")}if(this._enabledData){var b=this._dataServer.match(new RegExp("(.*)(\\[(\\d+)-(\\d+)\\])(.*)"));b?(this._dpHead=b[1],this._dpBody=b[5],this._dsnMin=parseInt(b[3]),this._dsnMax=parseInt(b[4])):(this._dpHead="",this._dpBody="",this._dsnMin="",this._dsnMax="")}},MLayer.prototype._initOptions=function(a){this._enabledTile=MTools.ifUndefined(a.enabledTile,!0),this._tileServer=a.tileServer,this._tileFormat=MTools.ifUndefined(a.tileFormat,"png"),this._autoLoadOfPan=MTools.ifUndefined(a.autoLoadOfPan,!0),this._enabledData=MTools.ifUndefined(a.enabledData,!1),this._dataServer=a.dataServer,this._dataFormat=MTools.ifUndefined(a.dataFormat,"js"),this._dataCallbackName=MTools.ifUndefined(a.dataCallbackName,"getPoiData"),this._zIndex=MTools.ifUndefined(a.zIndex,21),this._maxZoom=MTools.ifUndefined(a.maxZoom,MConfig.maxZoom),this._maxZoom=MTools.between(this._maxZoom,MConfig.minZoom,MConfig.maxZoom,MConfig.maxZoom),this._minZoom=MTools.ifUndefined(a.minZoom,MConfig.minZoom),this._minZoom=MTools.between(this._minZoom,MConfig.minZoom,this._maxZoom,MConfig.minZoom),this._allowedClear=this._allowedClear=MTools.ifUndefined(a.allowedClear,!0),this._tilePreprocessor=a.tilePreprocessor,this._tpContext=a.tpContext,this._dataPreprocessor=a.dataPreprocessor,this._dpContext=a.dpContext},MLayer.prototype._getDynamicMapUrl=function(a){var b=a.a_grid_x(),c=a.a_grid_y(),d=a.zoom();return MConfig.mapDirs[d]+"/"+b+"/"+c+"/?_="+MConfig.imgVersion};var MTraffic=MClass.create("MTraffic",MLayer);MTraffic.initialize=function(a){a=MTools.ifUndefined(a,{}),MLayer.initialize.call(this,a),this._timer=null,this._interval=300,this.setInterval(a.interval)},MTraffic.prototype._autoRefresh=function(){this.refresh()},MTraffic.prototype._resetTimer=function(){this._timer&&window.clearInterval(this._timer),this._timer=MTools.interval(this,this._autoRefresh,1e3*this._interval)},MTraffic.prototype.setMap=function(a){MLayer.prototype.setMap.apply(this,arguments),this.setMinZoom(this._minZoom),this.setMaxZoom(this._maxZoom),this._resetTimer()},MTraffic.prototype.setMinZoom=function(a){a=MTools.ifTypeOf(a,"number",this._minZoom),a=MTools.between(a,this._map._trafficMinZoom,map._trafficMaxZoom,this._map._trafficMinZoom),this._minZoom!=a&&(this._minZoom=a,this.refresh())},MTraffic.prototype.setMaxZoom=function(a){a=MTools.ifTypeOf(a,"number",this._maxZoom),a=MTools.between(a,this._map._trafficMinZoom,this._map._trafficMaxZoom,this._map._trafficMaxZoom),this._maxZoom!=a&&(this._maxZoom=a,this.refresh())},MTraffic.prototype.interval=function(){return this._interval},MTraffic.prototype.setInterval=function(a){this._interval=MTools.ifUndefined(a,this._interval),this._interval=MTools.between(this._interval,60,Number.MAX_VALUE,this._interval),this._resetTimer()},MTraffic.prototype.finalize=function(){this._timer&&window.clearInterval(this._timer),this._timer=null,MLayer.prototype.finalize.apply(this,arguments)},MTraffic.prototype._getDynamicMapUrl=function(a){var b=a.a_grid_x(),c=a.a_grid_y(),d=a.zoom();return"z="+MConfig.mapDirs[d]+"&x="+b+"&y="+c+"&_="+MConfig.imgVersion};var MConfig={mapDirs:["W","0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],lngSteps:[90,40,20,10,5,2,1,.5,.2,.1,.05,.02,.01,.005,.002,.001],latSteps:[72,32,16,8,4,1.6,.8,.4,.2*.8,.1*.8,.05*.8,.016,.008,.004,.0016,8e-4],gridFactors:[10,10,10,10,10,10,10,10,10,10,50,50,50,50,50],standardSafe:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],lonRange:[],latRange:[],gridWidth:300,gridHeight:300,keyOfCODE13:"",keyOfCODE14:"",minLevelGroup:0,maxLevelGroup:3,trafficMinZoom:8,minZoom:0,maxZoom:14,copyright:'<span style="font-size:14px;text-shadow:1px 1px 1px #fff;white-space:nowrap;overflow:hidden;">&copy&nbsp;2014&nbsp;Mapbar&nbsp;-&nbsp;GS(2013)6018号</span>',isUseImgVersion:!0,imgVersion:""},MDynamicConfig={mapDirs:["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20"],lngSteps:[],latSteps:[],gridWidth:256,gridHeight:256,trafficMinZoom:10,minZoom:0,maxZoom:18};MDynamicConfig.mapDirs.forEach(function(a,b){var c;c=b?MDynamicConfig.lngSteps[b-1]/2:360,MDynamicConfig.lngSteps[b]=c,MDynamicConfig.latSteps[b]=c/2}),function(){if(MConfig=MConfig||{},void 0!=typeof MConfig.isUseImgVersion&&MConfig.isUseImgVersion){var a=new Date,b=a.getMonth()+1,c="?",d=b<10?"0"+b:b,e=a.getDate();MConfig.imgVersion=c+d+e,MConfig.ivcb=function(a){MConfig.imgVersion=c+a};var f="mapbar.mobilePlugin.js",g="mImgVerScript",h="<script id='"+g+"' src='"+f+"'></script>";document.write(h);var i=document.getElementById(g);i.onload=function(){this.parentNode.removeChild(i)},i.onerror=function(){this.parentNode.removeChild(i)}}}();var MPoint=MClass.create("MPoint",MObject);MPoint.initialize=function(a,b,c){this.lat="number"==typeof b?Math.round(1e6*b)/1e6:null,this.lng="number"==typeof a?Math.round(1e6*a)/1e6:null,this.levelGroup=MConfig.maxLevelGroup,"number"==typeof c&&c>=MConfig.minLevelGroup&&c<=MConfig.maxLevelGroup&&(this.levelGroup=c)},MPoint.prototype.clone=function(){return new MPoint(this.lng,this.lat,this.levelGroup)},MPoint.prototype.equals=function(a){return a instanceof MPoint&&this.lat===a.lat&&this.lng===a.lng},MPoint.prototype.equalsAll=function(a){return this.equals(a)&&this.levelGroup===a.levelGroup},MPoint.prototype.toString=function(){return"MPoint: {"+this.lng+","+this.lat+"}"};var MTile=MClass.create("MTile",MObject);MTile.initialize=function(a,b,c){this._url="string"==typeof a?a:null,this._layer=b instanceof MLayer?b:null,this._grid=c instanceof MGrid?c:null,this._ready=!1},MTile.prototype.ready=function(){return this._ready},MTile.prototype.res=function(){return this._res},MTile.prototype.url=function(){return this._url},MTile.prototype.grid=function(){return this._grid},MTile.prototype.layer=function(){return this._layer},MTile.prototype.update=function(){},MTile.prototype.start=function(){},MTile.prototype.finalize=function(){MObject.prototype.finalize.apply(this)};var MImgTile=MClass.create("MImgTile",MTile);MImgTile.initialize=function(a,b,c){MTile.initialize.call(this,a,b,c),this._rTimes=0,this._fTimes=3,this._res=MElement.create$("img").setCss({position:"absolute",border:"none",margin:0,padding:0}).bind("load",this._load,this).bind("error",this._error,this).setAttr("src",this._url).get(0)},MImgTile.prototype.finalize=function(){this._res.src="",MEvent.unbind(this._res),MTools.removeNode(this._res),MTile.prototype.finalize.apply(this)},MImgTile.prototype.update=function(){var a=this._layer.map();a.isEnabledDynamicMap()?this.updateDynamic(a):this.updateDefault(a)},MImgTile.prototype.updateDefault=function(a){if(this._grid){var b=this._grid.bounds(),c=a.toPixel(new MPoint(b.min.lng,b.max.lat));MElement.$$(this._res).setCss({width:MConfig.gridWidth+"px",height:MConfig.gridHeight+"px",top:c.y+"px",left:c.x+"px"})}},MImgTile.prototype.start=function(){this._res.src=this._url},MImgTile.prototype._load=function(){this._ready=!0,this.update(),MEvent.trigger(this,"complete")},MImgTile.prototype._error=function(){this._rTimes<this._fTimes?(this._rTimes++,this._res.src=this._url):(this._ready=!0,MEvent.trigger(this,"failed"))},MImgTile.prototype.updateDynamic=function(a){if(this._grid){var b=this._grid.bounds(),c=a.toPixel(new MPoint(b.min.lng,b.max.lat));MElement.$$(this._res).setCss({width:MConfig.gridWidth+"px",height:MConfig.gridHeight+"px",top:c.y+"px",left:c.x+"px"})}};var MGrid=MClass.create("MGrid",MObject);MGrid.initialize=function(a,b){this._point=MClass.chkObj(a,MPoint),this._map=MClass.chkObj(b,MMap),this._zoom=this._map?this._map.zoom():null,this._tiles=[],this._bounds=null,this._areaX=null,this._areaY=null,this._rGridX=null,this._rGridY=null,this._id=null,this._dataX=null,this._dataY=null,this._point&&this._map?(this._x=Math.floor(parseFloat(this._point.lng)/MMap.lngStep(this._zoom)),this._y=Math.floor(parseFloat(this._point.lat)/MMap.latStep(this._zoom))):(this._x=null,this._y=null)},MGrid.prototype.point=function(){return this._point},MGrid.prototype.bounds=function(){if(!this._bounds){if("number"==typeof this._zoom){var a=MConfig.lngSteps[this._zoom],b=MConfig.latSteps[this._zoom],c=this._x,d=this._y;return this._bounds=new MBounds(new MPoint(c*a,d*b),new MPoint((c+1)*a,(d+1)*b))}return null}return this._bounds},MGrid.prototype.id=function(){return this._id||(this._id=this._zoom.toString(16)+this._x.toString(16)+"l"+this._y.toString(16).toLowerCase()),this._id},MGrid.prototype.area_x=function(){if("number"!=typeof this._areaX){if("number"==typeof this._zoom){var a=this._x,b=MMap.gridTCountOfLon(this._zoom);return a%=b,a>=b/2&&(a-=b),a<-b/2&&(a+=b),this._areaX=parseInt(Math.floor(a/MConfig.gridFactors[this._zoom])),this._areaX<0&&(this._areaX=0),this._areaX}return null}return this._areaX},MGrid.prototype.area_y=function(){return"number"!=typeof this._areaY?"number"==typeof this._zoom?(this._areaY=parseInt(Math.floor(this._y/MConfig.gridFactors[this._zoom])),this._areaY):null:this._areaY},MGrid.prototype.r_grid_x=function(){if("number"!=typeof this._rGridX){if("number"==typeof this._zoom){var a=this._x,b=MMap.gridTCountOfLon(this._zoom);return a%=b,a>=b/2&&(a-=b),a<-b/2&&(a+=b),this._rGridX=a-this.area_x()*MConfig.gridFactors[this._zoom],this._rGridX}return null}return this._rGridX},MGrid.prototype.r_grid_y=function(){return"number"!=typeof this._rGridY?"number"==typeof this._zoom?(this._rGridY=this._y-this.area_y()*MConfig.gridFactors[this._zoom],this._rGridY):null:this._rGridY},MGrid.prototype.a_grid_x=function(){return this._x},MGrid.prototype.a_grid_y=function(){return this._y},MGrid.prototype.zoom=function(){return"number"==typeof this._zoom?this._zoom:null},MGrid.prototype.addTile=function(a){a instanceof MTile&&this._tiles.push(a)},MGrid.prototype.tiles=function(){return this._tiles},MGrid.prototype.equals=function(a){return a instanceof MGrid&&a.zoom()===this._zoom&&a.a_grid_x()===this._x&&a.a_grid_y()===this._y},MGrid.prototype.setZoom=function(a){"number"==typeof a&&(this._zoom=a,this._bounds=null,this._areaX=null,this._areaY=null,this._rGridX=null,this._rGridY=null,this._id=null,this._x=Math.floor(parseFloat(this._point.lng)/MConfig.lngSteps[a]),this._y=Math.floor(parseFloat(this._point.lat)/MConfig.latSteps[a]))},MGrid.prototype.finalize=function(){MObject.prototype.finalize.apply(this)};var MDynamicGrid=MClass.create("MDynamicGrid",MGrid);MDynamicGrid.initialize=function(a,b){if(this._point=MClass.chkObj(a,MPoint),this._map=MClass.chkObj(b,MMap),this._zoom=this._map?this._map.zoom():null,this._tiles=[],this._bounds=null,this._areaX=null,this._areaY=null,this._rGridX=null,this._rGridY=null,this._id=null,this._dataX=null,this._dataY=null,this._point&&this._map){var c=MMap.LatLonToPixels(this._point.lng,this._point.lat,this._zoom);this._x=Math.floor(c.x/MConfig.gridWidth),this._y=Math.floor(c.y/MConfig.gridHeight)}else this._x=null,this._y=null},MDynamicGrid.prototype.point=function(){return this._point},MDynamicGrid.prototype.bounds=function(){if(!this._bounds){if("number"==typeof this._zoom){var a=this._point,b=this._x,c=this._y,d=this._zoom,e=MMap.PixelsToLatLon((b+1)*MConfig.gridWidth,(c+1)*MConfig.gridHeight,d);return this._bounds=new MBounds(new MPoint(a.lng,e.lat),new MPoint(e.lng,a.lat))}return null}return this._bounds},MDynamicGrid.prototype.id=function(){return this._id||(this._id=this._zoom.toString(16)+this._x.toString(16)+"l"+this._y.toString(16).toLowerCase()),this._id},MDynamicGrid.prototype.area_x=function(){if("number"!=typeof this._areaX){if("number"==typeof this._zoom){var a=this._x,b=MMap.gridTCountOfLon(this._zoom);return a%=b,a>=b/2&&(a-=b),a<-b/2&&(a+=b),this._areaX=parseInt(Math.floor(a/MConfig.gridFactors[this._zoom])),this._areaX<0&&(this._areaX=0),this._areaX}return null}return this._areaX},MDynamicGrid.prototype.area_y=function(){return"number"!=typeof this._areaY?"number"==typeof this._zoom?(this._areaY=parseInt(Math.floor(this._y/MConfig.gridFactors[this._zoom])),this._areaY):null:this._areaY},MDynamicGrid.prototype.r_grid_x=function(){if("number"!=typeof this._rGridX){if("number"==typeof this._zoom){var a=this._x,b=MMap.gridTCountOfLon(this._zoom);return a%=b,a>=b/2&&(a-=b),a<-b/2&&(a+=b),this._rGridX=a-this.area_x()*MConfig.gridFactors[this._zoom],this._rGridX}return null}return this._rGridX},MDynamicGrid.prototype.r_grid_y=function(){return"number"!=typeof this._rGridY?"number"==typeof this._zoom?(this._rGridY=this._y-this.area_y()*MConfig.gridFactors[this._zoom],this._rGridY):null:this._rGridY},MDynamicGrid.prototype.a_grid_x=function(){return this._x},MDynamicGrid.prototype.a_grid_y=function(){return this._y},MDynamicGrid.prototype.zoom=function(){return"number"==typeof this._zoom?this._zoom:null},MDynamicGrid.prototype.addTile=function(a){a instanceof MTile&&this._tiles.push(a)},MDynamicGrid.prototype.tiles=function(){return this._tiles},MDynamicGrid.prototype.equals=function(a){return a instanceof MDynamicGrid&&a.zoom()===this._zoom&&a.a_grid_x()===this._x&&a.a_grid_y()===this._y},MDynamicGrid.prototype.setZoom=function(a){"number"==typeof a&&(this._zoom=a,this._bounds=null,this._areaX=null,this._areaY=null,this._rGridX=null,this._rGridY=null,this._id=null,this._x=Math.floor(parseFloat(this._point.lng)/MConfig.lngSteps[a]),this._y=Math.floor(parseFloat(this._point.lat)/MConfig.latSteps[a]))},MDynamicGrid.prototype.finalize=function(){MObject.prototype.finalize.apply(this)};var MMap=MClass.create("MMap",MObject);MMap.initialize=function(a,b){MMap.addStyle||(MElement.create$("style").setAttr("type","text/css").html(MMap.strStyle).appendTo(document.head),MMap.addStyle=!0),this.dom=void 0,this._$dom=void 0,this._mapContainer=void 0,this._mapBackground=void 0,this._size=void 0,this._mapLayer=void 0,this._layersContainer=void 0,this._markerContainer=void 0,this._handleContainer=void 0,this._iwContainer=void 0,this._shadowContainer=void 0,this._canvasContainer=void 0,this._overlays={},this._traffic=void 0,this._infoWindows={},this._panels={},this._geoMarker=void 0,this._geoRange=void 0,this._geoPoint=void 0,this._geoAccuracy=void 0,this._gettingPosition=0,this._geoData=void 0,this._mousex=0,this._mousey=0,this._downx=0,this._downy=0,this._upx=0,this._upy=0,this._dragPixel=[null,null,null],this._dragedPixel=null,this._interval=void 0,this._gridComplete=!1,this._zoomChange=!1,this._timerRun=!1,this._touchstartTime=void 0,this._touchTimer=void 0,this._draged=!1,this._wpid=void 0,this._dragTime=[],this._dragPositions=[],this._dragAnime=void 0,this._panAnime=void 0,this._dragScrolling=!1,this._touchPixel=void 0,this._supportGestureEvent=!0,this._startedGesture=!1,this._gesturing=!1,this._justGesture=!1,this._scaleNote={start:null,pixel:[null,null],scale:[null,null]},this._scaleZoomed=!1,this._zoomedCenter=void 0,this._zoomedLevel=void 0,this._zooming=!1,this._initZoom=void 0,this._initCenter=void 0,this._offset=0,this._scaleX=void 0,this._scaleY=void 0,this._maxCol=void 0,this._minCol=void 0,this._maxRow=void 0,this._minRow=void 0,this._ctrX=void 0,this._ctrY=void 0,this._layers=[],this._layerArray=[],this._center=null,this._zoom=null,this._grids={},this._mode=MMapMode.PAN,this._startedDrag=!1,this._dragging=!1,this._markerMaxZIndex=0,this._canvasMaxZIndex=0,this._pinPanelMaxZIndex=0,this._floatPanelMaxZIndex=0,this._bgScale=4,this._vectors={},this._initOptions(b),this._$dom=MElement.$$(a),this.dom=this._$dom.get(0),MElement.isElement(this.dom,"div")&&(this._initHighResolution(),this._initStruct(),this._setDefaultStyle(),this._bindEvent(),this._updateData(),this._startBuildGrids(),this._addCopyright(),this._standardControl&&MTools.timeout(this,this._addStandardControl,200))},MMap.decodeLine=function(a,b){var c=[];if("string"!=typeof a||!a||"string"!=typeof b||!b||b.indexOf(",")===-1)return c;for(var d=MMap.decodePts(a),e=MMap.decodeLevels(b),f=0,g=d.length;f<g;f++)c.push(new MPoint(1e-5*d[f][1],1e-5*d[f][0],MTools.ifUndefined(e[f],0)));return c},MMap.decodePts=function(a){var b=[];if("string"==typeof a&&a){var c=MTools.decodeNumberEx(a),d=c[0],e=c[1];b.push([d,e]);for(var f=2,g=c.length;f<g;f+=2)d+=c[f],e+=c[f+1],b.push([d,e])}return b},MMap.decodeLevels=function(a){var b={};if("string"==typeof a&&a&&a.indexOf(",")!==-1)for(var c=a.split(","),d=0,e=c.length;d<e;d++)for(var f=MTools.decodeNumberEx(c[d]),g=0,h=0,i=f.length;h<i;h++)g+=f[h],b[g]=d+1;return b},MMap.prototype.setMaxZoom=function(a){this._setMaxZoom(a)},MMap.prototype.setMinZoom=function(a){this._setMinZoom(a)},MMap.prototype.setZoomRange=function(a,b){var c=this.zoom();a<=b&&(this._setMinZoom(a,!0,!0,!0),this._setMaxZoom(b,!0,!0,!0),c>this._maxZoom?this.setZoom(this._maxZoom):c<this._minZoom&&this.setZoom(this._minZoom)),MEvent.trigger(this,"zoomRange_change",this._minZoom,this._maxZoom)},MMap.prototype.getMinZoom=function(){return this._minZoom},MMap.prototype.getMaxZoom=function(){return this._maxZoom},MMap.prototype.getZoomRange=function(){return{minZoom:this._minZoom,maxZoom:this._maxZoom}},MMap.prototype.isEnabledDragging=function(){return!this._disableDragging},MMap.prototype.enableDragging=function(){this._disableDragging=!1},MMap.prototype.disableDragging=function(){this._disableDragging=!0},MMap.prototype.isEnabledDoubleClickZoom=function(){return!this._disableDoubleClickZoom},MMap.prototype.enableDoubleClickZoom=function(){this._disableDoubleClickZoom=!1},MMap.prototype.disableDoubleClickZoom=function(){this._disableDoubleClickZoom=!0},MMap.prototype.isEnabledInertialDragging=function(){return!this._disableIntertialDragging},MMap.prototype.enableIntertialDragging=function(){this._disableIntertialDragging=!1},MMap.prototype.disableIntertialDragging=function(){this._disableIntertialDragging=!0},MMap.prototype.enablePinchToZoom=function(){this._disablePinchToZoom=!1},MMap.prototype.disablePinchToZoom=function(){this._disablePinchToZoom=!0},MMap.prototype.resourceUrl=function(){return this._resourceUrl},MMap.prototype.setResourceUrl=function(a){this._resourceUrl=MTools.ifUndefined(a,"http://img.mapbar.com/maplite/images/")},MMap.prototype.defaultImgIconUrl=function(){return this._defaultImgIconUrl},MMap.prototype.setDefaultImgIconUrl=function(a){this._defaultImgIconUrl=a},MMap.prototype.isEnabledGeolocation=function(){return this._enabledGeolocation},MMap.prototype.enableGeolocation=function(){this._enabledGeolocation=!0},MMap.prototype.disableGeolocation=function(){this._enabledGeolocation=!1},MMap.prototype.isEnabledHighResolution=function(){return this._enabledHighResolution},MMap.prototype.center=function(){return this._center instanceof MPoint?this._center.clone():null},MMap.prototype.zoom=function(){return this._zoom},MMap.prototype.grids=function(){var a=[];for(var b in this._grids)a.push(this._grids[b]);return a},MMap.prototype.bounds=function(){return this._getBounds()},MMap.prototype.distance=function(a){var b=0,c=a instanceof Array?a.length:0;if(c<2)return b;for(var d=1;d<c;d++){var e=a[d-1],f=a[d],g=Math.round(1e6*f.lat-1e6*e.lat)/1e6,h=Math.round(1e6*f.lng-1e6*e.lng)/1e6;b+=Math.sqrt(g*g+h*h*.46)}return parseInt(111111*b)},MMap.prototype.size=function(){return this._size||(this._size=this._$dom.innerSize(!1)),this._size},MMap.prototype.setCenter=function(a){this._centerAndZoom(a,this._zoom)},MMap.prototype.setZoom=function(a){"number"==typeof a&&a>=this._minZoom&&a<=this._maxZoom&&this._zoom!==a&&this._centerAndZoom(this._center,a,arguments[1])},MMap.prototype.centerAndZoom=function(a,b){this._centerAndZoom(a,b)},MMap.prototype.resize=function(a){this._redrawMap(null,null,a)},MMap.prototype.zoomIn=function(){var a=this._zoom;a+=a<this._maxZoom?1:0,this.setZoom(a)},MMap.prototype.zoomOut=function(){var a=this._zoom;a-=a>this._minZoom?1:0,this.setZoom(a)},MMap.prototype.reset=function(){this._centerAndZoom(this._initCenter,this._initZoom)},MMap.prototype.intoView=function(a){if(MClass.classOf(a,MBounds)){var b,c,d=this._getBounds(),e=d.max.lng-d.min.lng,f=d.max.lat-d.min.lat,g=a.max.lng-a.min.lng,h=a.max.lat-a.min.lat;if(g>e||h>f){for(var i=this._zoom-1;i>=this._minZoom;i--)if(d=this._getBounds(this._center,i),e=d.max.lng-d.min.lng,f=d.max.lat-d.min.lat,g<e&&h<f){b=i;break}"undefined"==typeof b&&(b=this._zoom),c=a.mid()}else a.equals(d.intersects(a))||(b=this._zoom,c=a.mid());c&&b&&this.centerAndZoom(c,b)}},MMap.prototype.overlaysBounds=function(a){if(!a.length)return null;for(var b=null,c=0,d=a.length;c<d;c++){var e=a[c],f=e.bounds();f&&(c?(b.extends(f.min),b.extends(f.max)):b=f)}return b},MMap.prototype.setViewport=function(a){if(a instanceof MBounds){for(var b=a.mid(),c=this.getMaxZoom(),d=this._getBounds(b,c);!d.containsRange(a)&&c>this._minZoom;)d=this._getBounds(b,--c);c=c<=this._minZoom?this._minZoom:--c,this._centerAndZoom(b,c)}},MMap.prototype.panTo=function(a,b){b=b||{},b.noAnimation=MTools.ifUndefined(b.noAnimation,!1),this._centerAndZoom(a,this._zoom,!b.noAnimation)},MMap.prototype.panBy=function(a,b,c){c=c||{},c.noAnimation=MTools.ifUndefined(c.noAnimation,!1),a=MTools.ifTypeOf(a,"number",0),b=MTools.ifTypeOf(b,"number",0),this._centerAndZoom(this.toPoint(this._ctrX-a,this._ctrY-b),this._zoom,!c.noAnimation)},MMap.prototype.toPixel=function(a,b){var c;if(a instanceof MPoint)c=a.clone();else{if("number"!=typeof a||"number"!=typeof b)return null;c=new MPoint(a,b)}return this._getPixel(c)},MMap.prototype.toPoint=function(a,b){var c;if(a instanceof MPixel)c=a.clone();else{if("number"!=typeof a||"number"!=typeof b)return null;c=new MPixel(a,b)}return this._getPoint(c)},MMap.prototype.checkLevelGroup=function(a){return this._zoom>=0&&this._zoom<=3&&3===a.levelGroup||(this._zoom>=4&&this._zoom<=7&&a.levelGroup>=2||(this._zoom>=8&&this._zoom<=11&&a.levelGroup>=1||this._zoom>=12&&this._zoom<=18&&a.levelGroup>=0))},MMap.prototype.lngStep=function(){return MMap.lngStep("number"==typeof arguments[0]?arguments[0]:this._zoom)},MMap.prototype.latStep=function(){return MMap.latStep("number"==typeof arguments[0]?arguments[0]:this._zoom)},MMap.prototype.gridFactor=function(){return MConfig.gridFactors[this.zoom()]},MMap.prototype.layers=function(){return this._layers.concat()},MMap.prototype.addLayer=function(a){a instanceof MLayer&&(a.setMap(this),this._layersContainer.append(a.dom),this._layers.push(a))},MMap.prototype.removeLayer=function(a){for(var b,c,d=0,e=this._layers.length;d<e&&(b=this._layers[d],c=d,b!==a);d++);this._layers.splice(c,1),b.finalize()},MMap.prototype.clearLayer=function(){for(var a,b=0,c=this._layers.length;b<c;b++)a=this._layers[b],a._allowedClear&&this.removeLayer(a)},MMap.prototype.enableTraffic=function(a){this._traffic||(a=MTools.ifUndefined(a,{allowedClear:!1}),a.tileServer=this._trafficImgServer,a.zIndex=MSysLayerZIndex.TRAFFIC_LAYER,this._traffic=new MTraffic(a),this.addLayer(this._traffic))},MMap.prototype.disableTraffic=function(){this._traffic instanceof MTraffic&&(this.removeLayer(this._traffic),this._traffic=null)},MMap.prototype.setMapImageServer=function(a,b,c){this._mapBackground.setCss3({transition:"",transform:"scale(1) translate(0px, 0px)"}).html(this._mapImgLayer.html()),this._mapLayer.setTileServer(a,b,c)},MMap.prototype.overlays=function(){var a=[];for(var b in this._overlays)a.push(this._overlays[b]);return a},MMap.prototype.addOverlay=function(a){this._addOverlay(a)},MMap.prototype.removeOverlay=function(a,b,c){if(a instanceof MOverlay&&a.allowedClear()){b=MTools.ifTypeOf(b,"boolean",!0);var d=a.id();c||(b?a.finalize():a.remove()),delete this._overlays[d],delete this._vectors[d]}},MMap.prototype.clearOverlay=function(a){a=MTools.ifTypeOf(a,"boolean",!0);for(var b in this._overlays)this._overlays.hasOwnProperty(b)&&this.removeOverlay(this._overlays[b],a)},MMap.prototype.addPanel=function(a){a instanceof MPanel&&(a.setMap(this),this._panels[a.id()]=a)},MMap.prototype.removePanel=function(a,b){if(b=MTools.ifTypeOf(b,"boolean",!0),a instanceof MPanel){var c=a.id();b?a.finalize():a.remove(),delete this._panels[c]}},MMap.prototype.clearPanel=function(a){a=MTools.ifTypeOf(a,"boolean",!0);for(var b in this._panels)if(this._panels.hasOwnProperty(b)){var c=this._panels[b];c.allowedClear()&&this.removePanel(c,a)}},MMap.prototype.addInfoWindow=function(a){a instanceof MInfoWindowView&&(this._allowMultiInfoWindow||this.closeInfoWindow(),this._infoWindows[a.id()]=a,this._iwContainer.append(a.dom()))},MMap.prototype.openInfoWindow=function(a,b){var c=this.toPixel(a);c&&b instanceof MInfoWindowView&&(b.setMap(this),b.open(c))},MMap.prototype.closeInfoWindow=function(a){var b,c;if(a instanceof MInfoWindowView)c=a.id(),b=this._infoWindows[c],b.owner()||delete this._infoWindows[c],b.close();else if("undefined"==typeof a)for(var d in this._infoWindows)b=this._infoWindows[d],b.owner()||delete this._infoWindows[d],b.close()},MMap.prototype.removeInfoWindow=function(a){if(a instanceof MInfoWindowView){var b=a.id();a.remove(),delete this._infoWindows[b]}},MMap.prototype.nextMarkerZIndex=function(){return++this._markerMaxZIndex},MMap.prototype.nextCanvasZIndex=function(){return++this._canvasMaxZIndex},MMap.prototype._nextPinPanelZIndex=function(){return++this._pinPanelMaxZIndex},MMap.prototype._nextFloatPanelZIndex=function(){return++this._floatPanelMaxZIndex},MMap.prototype.mode=function(){return this._mode},MMap.prototype.enablePanMode=function(){this._mode=MMapMode.PAN},MMap.prototype.enableMarkerMode=function(a){},MMap.prototype.getCurrentPosition=function(a,b){if(this._enabledGeolocation&&!this._gettingPosition){if("function"!=typeof this._getPositionAgent){if(!navigator.geolocation)return!1;this._geoData=MTools.extend(b),this._gettingPosition=0,this._startLocation("getCurrentPosition",a)}else this._geoData=MTools.extend(b),this._gettingPosition=0,this._getPositionAgent();return this._triggerGeoStartEvent(this._geoData),!0}return!1},MMap.prototype.watchPosition=function(a,b){if(this._enabledGeolocation&&!this._gettingPosition){if("function"!=typeof this._watchPositionAgent){if(!navigator.geolocation&&void 0==this._wpid)return!1;this._geoData=MTools.extend(b),this._gettingPosition=2,this._wpid=this._startLocation("watchPosition",a)}else this._geoData=MTools.extend(b),this._gettingPosition=2,this._watchPositionAgent();return this._triggerGeoStartEvent(this._geoData),!0}return!1},MMap.prototype.stopWatchPosition=function(){if(this._enabledGeolocation){if("function"!=typeof this._stopWatchPositionAgent){if(void 0==this._wpid||!navigator.geolocation)return;navigator.geolocation.clearWatch(this._wpid),this._wpid=void 0}else this._stopWatchPositionAgent();this._gettingPosition=0,MEvent.trigger(this,"watchposition_stop",this._geoData)}},MMap.prototype.geoSuccess=function(a){a=a||{},1===this._gettingPosition&&(this._gettingPosition=0),MEvent.trigger(this,"geo_success",a,this._geoData)},MMap.prototype.geoFailed=function(a){a=a||{},1===this._gettingPosition&&(this._gettingPosition=0),MEvent.trigger(this,"geo_failed",a,this._geoData)},MMap.prototype.finalize=function(){for(var a in this._overlays)this._overlays.hasOwnProperty(a)&&this._overlays[a].finalize(),this._overlays[a]=null,delete this._overlays[a];this._geoMarker&&this._geoMarker.finalize();for(var b=0,c=this._panels.length;b<c;b++)this._panels[b].finalize();this._panels.length=0,MEvent.unbind(this.dom),this._dragAnime||MEvent.unbind(this._dragAnime),MEvent.unbind(window,"unload",this.finalize),this._clearGrid();for(var d=0,e=this._layers.length;d<e;d++)this._layers[d].finalize();this._layers.length=0,MElement.$$([this._panelContainer,this._mapContainer]).remove(),MObject.prototype.finalize.apply(this,arguments)},MMap.prototype._renderBackground=function(a){if("string"==typeof a&&this._mapBackground._grids[a]instanceof MGrid){var b=this._mapBackground._grids[a],c=this._zoom-this._bgScale<0?0:this._zoom-this._bgScale,d=b.bounds(),e=MMap.pixelDistance(this._center,new MPoint(d.min.lng,d.max.lat),c),f=MMap.lngStep(c)/MMap.lngStep(this._zoom),g=this._mapBackground._tiles[a],h=300*f*2,i=(this._size.width-h)/2,j=(this._size.height-h)/2;g.ready()&&(this._mapBgContext.drawImage(g.res(),e.x/2,e.y/2,150,150),this._mapBgCanvas.setCss({width:h+"px",height:h+"px",top:j+"px",left:i+"px"}))}else if("undefined"==typeof a)for(var k in this._mapBackground._grids)arguments.callee(k)},MMap.prototype._renderMap=function(a){if("string"==typeof a){var b,c,d,e,f,g=this._grids[a];if(g instanceof MGrid){b=g.bounds(),c=this.toPixel(new MPoint(b.min.lng,b.max.lat)),d=this._mapLayer.tiles()[a],d instanceof MTile&&d.ready()&&this._drawMapImage(d.res(),c);for(var h=0,i=this._layerArray.length;h<i;h++)if(e=this._layerArray[h],e instanceof Array)for(var j=0,k=e.length;j<k;j++)f=e[j],f instanceof MLayer&&(d=f.tiles()[a],d instanceof MTile&&d.ready()&&this._drawMapImage(d.res(),c))}}else for(var l in this._grids)arguments.callee.call(this,l)},MMap.prototype._drawMapImage=function(a,b){this._dragging?this._loadContext.drawImage(a,b.x,b.y):this._mapContext.drawImage(a,b.x,b.y)},MMap.prototype._initHighResolution=function(){if(!this.isEnabledDynamicMap()&&this.isEnabledHighResolution())for(var a=0,b=MConfig.lngSteps.length;a<b;a++)MConfig.lngSteps[a]=MConfig.lngSteps[a]/2,MConfig.latSteps[a]=MConfig.latSteps[a]/2},MMap.prototype._initStruct=function(){this.size(),this._mapContainer=MElement.create$("div").setAttr("id","mapContainer").appendTo(this._$dom),this._setContainerStyle(this._mapContainer,{zIndex:MSysLayerZIndex.MAP_CONTAINER}),this._mapBackground=MElement.create$("div").setAttr("id","mapBackground").appendTo(this._mapContainer),this._setContainerStyle(this._mapBackground,{zIndex:MSysLayerZIndex.MAP_BACKGROUND}),this._mapLayer=new MLayer({tileServer:this._mapImgServer,tileFormat:this._mapImgFormat,zIndex:MSysLayerZIndex.MAP_LAYER,
maxZoom:this._maxZoom,minZoom:this._minZoom,allowedClear:!1,autoLoadOfPan:this._autoLoadOfPan}),this._mapLayer.setMap(this),this._mapContainer.append(this._mapLayer.dom),this._mapImgLayer=MElement.$$(this._mapLayer.dom).setCss3({"transform-origin":"",transition:"",transform:"scale(1)"}),this._layersContainer=MElement.create$("div").setAttr("id","layersContainer").appendTo(this._mapContainer),this._setContainerStyle(this._layersContainer,{width:0,height:0,zIndex:MSysLayerZIndex.LAYERS_CONTAINER}),this._canvasContainer=MElement.create$("div").setAttr({id:"canvasContainer",width:this._size.width,height:this._size.height}).appendTo(this._mapContainer),this._setContainerStyle(this._canvasContainer,{width:0,height:0,zIndex:MSysLayerZIndex.SVG_CONTAINER}),MTools.supportSVG&&(this._svgContainer=MElement.createSVG$("svg").setAttr({version:"1.1",overflow:"visible",viewBox:[-this._size.width,-this._size.height,3*this._size.width,3*this._size.height].join(" "),height:3*this._size.height,width:3*this._size.width}).setCss({position:"absolute",top:-this._size.height+"px",left:-this._size.width+"px"}).appendTo(this._canvasContainer)),this._shadowContainer=MElement.create$("div").setAttr("id","shadowContainer").appendTo(this._mapContainer),this._setContainerStyle(this._shadowContainer,{zIndex:MSysLayerZIndex.SHADOW_CONTAINER,width:0,height:0}),this._markerContainer=MElement.create$("div").setAttr("id","markerContainer").appendTo(this._mapContainer),this._setContainerStyle(this._markerContainer,{zIndex:MSysLayerZIndex.MARKER_CONTAINER,width:0,height:0}),this._handleContainer=MElement.create$("div").setAttr("id","handleContainer").appendTo(this._mapContainer),this._setContainerStyle(this._handleContainer,{zIndex:MSysLayerZIndex.HANDLE_CONTAINER,width:0,height:0}),this._iwContainer=MElement.create$("div").setAttr("id","iwContainer").appendTo(this._mapContainer),this._setContainerStyle(this._iwContainer,{zIndex:MSysLayerZIndex.IW_CONTAINER,width:0,height:0}),this._panelContainer=MElement.create$("div").setAttr("id","panelContainer").appendTo(this._$dom),this._setContainerStyle(this._panelContainer,{zIndex:MSysLayerZIndex.PANEL_CONTAINER,width:0,height:0}),this._pinPanelContainer=MElement.create$("div").setAttr("id","pinPanelContainer").appendTo(this._panelContainer),this._setContainerStyle(this._pinPanelContainer,{zIndex:0,width:0,height:0}),this._floatPanelContainer=MElement.create$("div").setAttr("id","floatPanelContainer").appendTo(this._panelContainer),this._setContainerStyle(this._floatPanelContainer,{zIndex:1,width:0,height:0})},MMap.prototype._addCopyright=function(){this.addPanel(new MCopyright(this._copyrightOpts))},MMap.prototype._addStandardControl=function(){this.addPanel(new MStandardControl(this._standardControlOpts))},MMap.prototype._setDefaultStyle=function(){this._$dom.setCss({position:"relative",overflow:"hidden",padding:0,backgroundColor:this._backgroundColor,"user-select":"none"})},MMap.prototype._getPixel=function(a,b,c){return this.isEnabledDynamicMap()?this._getDynamicPixel.apply(this,arguments):this._getDefaultPixel.apply(this,arguments)},MMap.prototype._getDefaultPixel=function(a,b,c){if(a instanceof MPoint){b=b||this._center;var d,e,f,g,h,i=Math.round(1e6*b.lng-1e6*a.lng)/1e6,j=Math.round(1e6*a.lat-1e6*b.lat)/1e6;return void 0===c?(d=this._scaleX,e=this._scaleY,f=this._offset):(d=MMap.lngStep(c)/MConfig.gridWidth,e=MMap.latStep(c)/MConfig.gridHeight,f=-MConfig.standardSafe[c]),g=Math.round(i/d),h=Math.round(j/e)+f,new MPixel(Math.round(this._ctrX-g),Math.round(this._ctrY-h))}return null},MMap.prototype._getPoint=function(a,b,c){return this.isEnabledDynamicMap()?this._getDynamicPoint.apply(this,arguments):this._getDefaultPoint.apply(this,arguments)},MMap.prototype._getDefaultPoint=function(a,b,c){if("number"!=typeof a.x||"number"!=typeof a.y)return null;b=b||this.center();var d=Math.round(this._ctrX-a.x),e=Math.round(this._ctrY-a.y),f=Math.round(this.lngStep(c)/MConfig.gridWidth*d*1e6)/1e6,g=Math.round(this.latStep(c)/MConfig.gridHeight*e*1e6)/1e6,h=Math.round(1e6*b.lng-1e6*f)/1e6,i=Math.round(1e6*b.lat+1e6*g)/1e6;return new MPoint(h,i)},MMap.prototype._centerAndZoom=function(a,b,c){if(c=MTools.ifUndefined(c,!0),a instanceof MPoint&&"number"==typeof b){var d=!a.equals(this._center),e=b>=this._minZoom&&b<=this._maxZoom&&b!==this._zoom,f=this.bounds().contains(a),g=this.toPixel(a);if(!e&&d&&f&&c)this._dragPixel[0]=new MPixel(0,0),this._dragPixel[1]=new MPixel(0,0),this._dragPixelBak=this._dragPixel[1].clone(),this._prepareSlidePan(),this._startSlide({x:this._ctrX-g.x,y:this._ctrY-g.y},{x:0,y:0});else if(e&&f&&c){var h=g.x-this._ctrX,i=g.y-this._ctrY,j=this.lngStep(b)/this.lngStep(this._zoom),k=this.latStep(b)/this.latStep(this._zoom),l=Math.round(h/(j-1)),m=Math.round(i/(k-1)),n=this._ctrX-l,o=this._ctrY-m;this._startZoom(b,new MPixel(n,o))}else this._redrawMap(a,b)}},MMap.prototype._redrawMap=function(a,b,c){var d=this._setCenter(a),e=this._setZoom(b),f=this._setSize(c);(e||d||f)&&(this._mapBackground.show(),(e||d)&&(this._clearGrid(),this._mapImgLayer.setCss3({"transform-origin":"",transition:"",transform:"scale(1)"})),this._buildGrid(!0)),this._rePaintOverlay()},MMap.prototype._refreshBackground=function(){MTools.timeout(this,function(){var a=this._mapBgContext.canvas;this._mapBgContext.clearRect(-a.width,-a.height,2*a.width,2*a.height),this._mapBackground.sync()},10)},MMap.prototype._clearUpGrid=function(){var a,b=this.bounds();for(var c in this._grids)a=this._grids[c],b.intersects(a.bounds())||this._removeGrid(a)},MMap.prototype._clearGrid=function(){this._removeGrid(this.grids())},MMap.prototype._buildGrid=function(a,b){this.isEnabledDynamicMap()?this._buildDynamicGrid.apply(this,arguments):this._buildDefaultGrid.apply(this,arguments)},MMap.prototype._buildDefaultGrid=function(a,b){if(a||!this._gridComplete&&!this._timerRun){this._timerRun=!0;var c,d=b||this.bounds(),e=this._zoom,f=this._center,g=MMap.lngStep(e),h=MMap.latStep(e),i=this._scaleX,j=this._scaleY,k=[],l=[];if(this._dragging){if(this._dragedPixel){var m=this._dragedPixel,n=m.x,o=m.y,p=n*i,q=o*j,r=d.min.lng-p,s=d.min.lat+q,t=d.max.lng-p,u=d.max.lat+q;d=new MBounds(new MPoint(r,s),new MPoint(t,u)),f=d.mid()}}else for(var v in this._grids)MEvent.trigger(this,"grid_updated",this._grids[v]);for(var w=0;w<=this._maxCol;w++)for(var x=0;x<=this._maxRow;x++)if(0!==w||0!==x){k=0===w?[f.lng]:[Math.round(1e6*f.lng+w*g*1e6)/1e6,Math.round(1e6*f.lng-w*g*1e6)/1e6],l=0===x?[f.lat]:[Math.round(1e6*f.lat+x*h*1e6)/1e6,Math.round(1e6*f.lat-x*h*1e6)/1e6];for(var y=0,z=k.length;y<z;y++)for(var A=0,B=l.length;A<B;A++)c=new MGrid(new MPoint(k[y],l[A]),this),d.isIntersect(c.bounds())&&this._addGrid(c)}else this._addGrid(new MGrid(f,this));this._gridComplete=!0,this._zoomChange=!1,this._timerRun=!1}},MMap.prototype._startSlide=function(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=600,g=Math.sqrt(d*d+e*e)/f;this._panAnime?this._panAnime.runing()&&this._panAnime.stop(!0):(this._panAnime=new MAnime({method:MTools.tween.Cubic.easeInOut}),MEvent.bind(this._panAnime,"changed",this._easeMove,this),MEvent.bind(this._panAnime,"stoped",this._stopDrag,this)),0!==c&&(c=c||g),this._panAnime.setBegins(b),this._panAnime.setEnds(a),this._panAnime.setDuration(c),this._panAnime.start()},MMap.prototype._addGrid=function(a){var b=a.id();this._grids[b]||(this._grids[b]=a,MEvent.trigger(this,"grid_created",a,this._dragging?MGridEventAction.DRAGGING:MGridEventAction.NORMAL))},MMap.prototype._removeGrid=function(a){if(a instanceof Array)for(var b=0,c=a.length;b<c;b++)this._removeGrid(a[b]);else if(a&&(a instanceof MGrid||"string"==typeof a)){var d=a instanceof MGrid?a.id():a,e=this._grids[d];delete this._grids[d],MEvent.trigger(this,"grid_removed",e)}},MMap.prototype._updateData=function(){var a=this.size();this._offset=-MConfig.standardSafe[this._zoom],this._scaleX=this.lngStep()/MConfig.gridWidth,this._scaleY=this.latStep()/MConfig.gridHeight,this._maxCol=Math.ceil(a.width/MConfig.gridWidth/2),this._minCol=-this._maxCol,this._maxRow=Math.ceil(a.height/MConfig.gridHeight/2),this._minRow=-this._maxRow,this._ctrX=Math.round(a.width/2),this._ctrY=Math.round(a.height/2)},MMap.prototype._bindEvent=function(){this._supportGestureEvent=MEvent.eventSupported("gesturestart",document.body),MEvent.eventSupported("touchstart",document.body)?(this._$dom.touchstart(this._startDrag,this,{evtMode:"t"}),this._$dom.touchmove(this._drag,this,{evtMode:"t",evt:"touchmove"}),this._$dom.touchend(this._endDrag,this,{evtMode:"t"}),this._$dom.bind("gesturestart",this._gestureStart,this),this._$dom.bind("gesturechange",this._gestureChange,this),this._$dom.bind("gestureend",this._gestureEnd,this)):(this._$dom.click(this._click,this),this._$dom.dblclick(this._doubleClick,this),this._$dom.mousedown(this._startDrag,this,{evtMode:"m"}),this._$dom.mouseup(this._endDrag,this,{evtMode:"m"}),this._$dom.mousemove(this._drag,this,{evtMode:"m",evt:"mousemove"}),this._$dom.mousewheel(this._mouseWheel,this)),MEvent.bind(window,"unload",this.finalize,this)},MMap.prototype._touchStartVector=0,MMap.prototype._getTouchVector=function(a,b){var c=Math.abs(a.clientX-b.clientX),d=Math.abs(a.clientY-b.clientY);return Math.sqrt(c*c+d*d)},MMap.prototype._touchGestureStart=function(a){this._supportGestureEvent||this._disablePinchToZoom||(this._touchStartVector=this._getTouchVector(a.touches[0],a.touches[1]),this.startScaleZoom())},MMap.prototype._touchGestureEnd=function(a){this._supportGestureEvent||this._disablePinchToZoom||(this._startedGesture=!1,this._justGesture=!0,this._touchStartVector=0,this.endScaleZoom())},MMap.prototype._touchGestureChange=function(a){if(!this._supportGestureEvent&&!this._disablePinchToZoom){var b=a.touches[0],c=a.touches[1],d=Math.abs(b.clientX+c.clientX)/2,e=Math.abs(b.clientY+c.clientY)/2,f=this._getTouchVector(b,c),g=new MPixel(d,e);this.scaleZoom(g,f/this._touchStartVector)}},MMap.prototype._updateDragData=function(a,b,c){c&&(this._dragTime.length=0,this._dragPositions.length=0),this._dragTime.push(a),this._dragPositions.push(b),this._dragTime.length>5&&(this._dragTime.shift(),this._dragPositions.shift())},MMap.prototype._startDrag=function(a){a.preventDefault(),a.stopPropagation(),this._draged=!1,this._touchPixel=void 0,this._justGesture=!1;var b,c=a.e,d="m"===a.data.evtMode,e=d?this._getMousePosition(c):this._getTouchPosition(c.changedTouches[0]);return c.touches&&c.touches.length>=2?void this._touchGestureStart(c):void(this._startedGesture||(this._touchPixel=e.clone(),b=this.toPoint(e),this._disableDragging||(this._startedDrag=!0,this._dragScrolling&&this._dragAnime&&(this._dragAnime.stop(),this._dragScrolling=!1),!this._disableIntertialDragging&&this._updateDragData((new Date).getTime(),e,!0),d||(c.timeStamp-this._touchstartTime>200||!this._touchstartTime||Math.abs(this._downx-e.x)>10||Math.abs(this._downy-e.y)>10?this._touchstartTime=c.timeStamp:(clearTimeout(this._touchTimer),this._doubleClick({},e))),this._downx=e.x,this._downy=e.y,this._dragPixel[0]=e,MEvent.trigger(this,"dragstart",e,b))))},MMap.prototype._endDrag=function(a){a.preventDefault(),a.stopPropagation();var b=a.e,c="m"==a.data.evtMode,d=c?this._getMousePosition(b):this._getTouchPosition(b.changedTouches[0]);if(this._touchGestureEnd(b),!this._zooming){if(!this._draged)return this._startedDrag=!1,!c&&this._touchPixel&&d&&Math.abs(this._touchPixel.x-d.x)<=5&&Math.abs(this._touchPixel.y-d.y)<=5&&this._triggerClickEvent(d),void(this._touchPixel=null);if(this._startedGesture||this._justGesture)return void(this._dragging=!1);if(c&&!this._disableDragging||!c&&!this._disableDragging&&this._draged)if(this._startedDrag=!1,this._disableIntertialDragging)this._stopDrag();else{this._updateDragData((new Date).getTime(),d);var e=this._dragTime.length-1,f=this._dragTime[e]-this._dragTime[0],g=this._dragTime[e]-this._dragTime[e-1],h=this._dragPositions[e].x-this._dragPositions[0].x,i=this._dragPositions[e].y-this._dragPositions[0].y,j=Math.round(Math.sqrt(h*h+i*i)/f*100)/100;if(g<40&&f<100){var k=Math.round(h*j*.3),l=Math.round(i*j*.3);this._dragPixelBak=this._dragPixel[1].clone(),this._startSlideMove({x:k,y:l},{x:0,y:0},Math.round(f*j/10*1.5)/100)}else this._stopDrag()}else this._stopDrag()}},MMap.prototype._stopDrag=function(){this._startedDrag=!1,this._dragging=!1,this._draged=!1,this._dragging=!1,this._resumeMap()},MMap.prototype._drag=function(a){a.preventDefault(),a.stopPropagation();var b,c=a.e,d="m"===a.data.evtMode;return c.touches&&c.touches.length>=2?void this._touchGestureChange(c):(b=d?this._getMousePosition(c):this._getTouchPosition(c.changedTouches[0]),this._mousex=b.x,this._mousey=b.y,void(this._startedGesture||this._justGesture||this._startedDrag&&(this._dragPixel[1]=b,this._draged||this._prepareSlidePan())))},MMap.prototype._prepareSlidePan=function(){this._draged=!0,this._dragging=!0,this._gridComplete=!1,window.requestAnimationFrame(this._getDragInterval()),MTools.timeout(this,function(){this._mapBackground.empty()},0)},MMap.prototype._getDragInterval=function(){return this._di||(this._di=this._dragInterval.bind(this)),this._di},MMap.prototype._dragInterval=function(){var a=this._dragPixel[0],b=this._dragPixel[1],c=this._dragPixel[2];this._draged&&(a instanceof MPixel&&b instanceof MPixel&&!b.equals(c)&&(this._dragedPixel=new MPixel(Math.round(b.x-a.x),Math.round(b.y-a.y)),!this._disableIntertialDragging&&this._updateDragData((new Date).getTime(),this._dragPixel[1]),this._mapContainer.setCss({top:this._dragedPixel.y+"px",left:this._dragedPixel.x+"px"}),this._dragPixel[2]=this._dragPixel[1],this._autoLoadOfPan&&this._buildGrid(!0),MEvent.trigger(this,"dragging",new MPixel(b.x-a.x,b.y-a.y))),window.requestAnimationFrame(this._getDragInterval()))},MMap.prototype._paintOverlay=function(a){var b=a instanceof MPixel?a:this._dragedPixel;MElement.$$([this._canvasContainer,this._shadowContainer,this._iwContainer,this._markerContainer,this._pinPanelContainer]).setCss({top:b.y+"px",left:b.x+"px"})},MMap.prototype._click=function(a){if(this._dragging||this._draged)this._dragScrolling||(this._dragging=!1);else{var b=a.e,c=this._getMousePosition(b);this._triggerClickEvent(c)}},MMap.prototype._triggerClickEvent=function(a){this._closeInfoWindowOnMapClick&&this.closeInfoWindow(),MEvent.trigger(this,"click",a,this.toPoint(a))},MMap.prototype._triggerGeoStartEvent=function(a){MEvent.trigger(this,"geo_start",this._geoData)},MMap.prototype._doubleClick=function(a,b){var c=a.e,d=b||this._getMousePosition(c);if(!this._disableDoubleClickZoom&&!this._zooming&&this._zoom<this._maxZoom){var e=this._zoom+1;this._startZoom(e,d)}MEvent.trigger(this,"dblclick",d,this.toPoint(d))},MMap.prototype._mouseWheel=function(a){a.preventDefault(),a.stopPropagation();var b=a.e,c=this._getMousePosition(b),d=this.zoom()+b.delta;d<=this._maxZoom&&d>=this._minZoom&&this._startZoom(d,c)},MMap.prototype._gestureStart=function(a){this._disablePinchToZoom||this.startScaleZoom()},MMap.prototype._gestureChange=function(a){if(!this._disablePinchToZoom){var b=a.e,c=this._getTouchPosition(b);this._dragedPixel instanceof MPixel&&(c=new MPixel(c.x-this._dragedPixel.x,c.y-this._dragedPixel.y)),this.scaleZoom(c,b.scale)}},MMap.prototype._gestureEnd=function(a){this._disablePinchToZoom||(this._startedGesture=!1,this._justGesture=!0,this.endScaleZoom())},MMap.prototype._getZoomByScale=function(a){if(1===a||Math.abs(a-1)<.2)return this._zoom;var b,c=MConfig.lngSteps.concat(),d=c[this._zoom],e=d/a,f=this._zoom;if(a>1){for(var g=0,h=c.length;g<h;g++)if(b=c[g],b<e){f=g;break}}else for(var i=c.length-1;i>=0;i--)if(b=c[i],b>e){f=i;break}return f},MMap.prototype._getZoomScale=function(a,b){return MConfig.lngSteps[a]/MConfig.lngSteps[b]},MMap.prototype.startScaleZoom=function(){this._startedGesture=!0,this._showOverlayLayers(!1),this._mapBackground.setCss({top:0,left:0}),this._scaleTimer=MTools.interval(this,this._scaleZoom,0)},MMap.prototype.endScaleZoom=function(){window.clearInterval(this._scaleTimer);var a,b,c,d,e,f,g,h,i,j=MConfig.lngSteps,k=this._size,l=new MPixel(Math.round(k.width/2),Math.round(k.height/2)),m=this._scaleNote.start,n=this._scaleNote.pixel[1],o=this._scaleNote.scale[1];n&&o&&(h=this._getZoomByScale(o),o=Math.round(j[this._zoom]/j[h]*1e6)/1e6,a=new MPixel(Math.round(m.x-n.x),Math.round(m.y-n.y)),this._scaleNote.scale[0]=o,this._scaleZoom(),d=new MPixel(Math.round(l.x-m.x),Math.round(l.y-m.y)),e=Math.round(d.x*(1-o)/o),f=Math.round(d.y*(1-o)/o),b=Math.round(a.x/o),c=Math.round(a.y/o),g=new MPixel(Math.round(l.x+e+b),Math.round(l.y+f+c)),i=this._getPoint(g),this._mapBackground.html(this._mapImgLayer.html()).show(),this._dragedPixel&&this._mapBackground.setCss3({top:this._dragedPixel.y+"px",left:this._dragedPixel.x+"px"}),this._mapImgLayer.setCss({top:0,left:0}).setCss3({transform:"translate(0,0) scale(1)"}),this._centerAndZoom(i,h,!1)),this._showOverlayLayers(),this._scaleZoomed=!1,this._scaleNote.start=null,this._scaleNote.pixel=[null,null],this._scaleNote.scale=[null,null],this._dragging&&(this._startedDrag=!1,this._dragging=!1,this._draged=!1,this._dragging=!1,this._resumeMap())},MMap.prototype._scaleZoom=function(){this._scaleZoomed||(this._scaleZoomed=!0);var a,b,c=this._scaleNote.pixel,d=this._scaleNote.scale,e=this._scaleNote.start,f=c[0],g=d[0];f&&(a=Math.round((f.x-e.x)/g),b=Math.round((f.y-e.y)/g)),!f||!g||f.equals(c[1])&&g===d[1]||(this._mapImgLayer.setCss3({"transform-origin":e.x+"px "+e.y+"px",transition:"",transform:"scale("+g+") translate("+a+"px,"+b+"px)"}),this._mapBackground.setCss3({"transform-origin":e.x+"px "+e.y+"px",transform:"scale("+g+") translate("+a+"px,"+b+"px)"}).hide(),this._scaleNote.pixel[1]=this._scaleNote.pixel[0].clone(),this._scaleNote.scale[1]=this._scaleNote.scale[0])},MMap.prototype._startZoom=function(a,b){this.isEnabledDynamicMap()?this._startDynamicZoom.apply(this,arguments):this._startDefaultZoom.apply(this,arguments)},MMap.prototype._startDefaultZoom=function(a,b){if(!(this._zooming||this._dragging||a>this._maxZoom||a<this._minZoom)){this._showOverlayLayers(!1),this._zooming=!0;var c=MConfig.gridWidth,d=MConfig.gridHeight,e=this._getPoint(b),f=Math.round(this._ctrX-b.x),g=Math.round(this._ctrY-b.y),h=Math.round(f*MMap.lngStep(a)/c*1e6)/1e6,i=Math.round(g*MMap.latStep(a)/d*1e6)/1e6,j=Math.round(1e6*e.lng+1e6*h)/1e6,k=Math.round(1e6*e.lat-1e6*i)/1e6;this._zoomedCenter=new MPoint(j,k),this._zoomedLevel=a,this._refPixel=b,this._zoomScale=MMap.lngStep(this._zoom)/MMap.lngStep(a),this._startEaseZoom(a,b)}},MMap.prototype._startEaseZoom=function(a,b){MTools.browser.android&&parseInt(MTools.browser.android.split(".")[0])<4?MMap.prototype._startEaseZoom=function(a,b){this._mapBackground.setCss({top:0,left:0}),this._zoomAnime||(this._zoomAnime=new MAnime({method:MTools.tween.Cubic.easeInOut}),MEvent.bind(this._zoomAnime,"changed",this._easeZoom,this,{refPixel:b}),MEvent.bind(this._zoomAnime,"stoped",this._endEaseZoom,this)),this._zoomAnime.setBegins({s:1}),this._zoomAnime.setEnds({s:this._zoomScale}),this._zoomAnime.setDuration(.3),this._mapImgLayer.setCss3({"transform-origin":b.x+"px "+b.y+"px",transition:""}),this._mapBackground.hide().setCss3({"transform-origin":b.x+"px "+b.y+"px",transform:"scale("+this._zoomScale+")"}).html(this._mapImgLayer.html()),this._zoomAnime.start()}:MMap.prototype._startEaseZoom=function(a,b){this._mapBackground.setCss({top:0,left:0}),this._mapImgLayer.setCss3({"transform-origin":b.x+"px "+b.y+"px",transition:"all 0.3s ease-in-out",transform:"scale("+this._zoomScale+")"}),this._mapBackground.hide().setCss3({"transform-origin":b.x+"px "+b.y+"px",transform:"scale("+this._zoomScale+")"}).html(this._mapImgLayer.html()),MEvent.one(this._mapImgLayer.get(0),MEvent.Events.transitionend,function(){this._endEaseZoom()},this)},this._startEaseZoom(a,b)},MMap.prototype._easeZoom=function(a,b,c){this._mapImgLayer.setCss3({transform:"scale("+b.s+")"})},MMap.prototype.scaleZoom=function(a,b){!this._scaleNote.start&&(this._scaleNote.start=a.clone());var c=MConfig.lngSteps,d=c[this._zoom]/b,e=c[this._minZoom],f=c[this._maxZoom];this._scaleNote.pixel[0]=a,d<e&&d>f&&(this._scaleNote.scale[0]=b)},MMap.prototype._endEaseZoom=function(a){this._showOverlayLayers(),this._redrawMap(this._zoomedCenter,this._zoomedLevel),MTools.timeout(this,function(){this._zooming=!1},200)},MMap.prototype._startSlideMove=function(a,b,c){var d=this,e=b.x-a.x,f=b.y-a.y;this._dragAnime?this._dragAnime.stop():(this._dragAnime=new MAnime({method:MTools.tween.Quad.easeOut}),MEvent.bind(this._dragAnime,"changed",this._easeMove,this),MEvent.bind(this._dragAnime,"stoped",function(){d._dragScrolling=!1,d._stopDrag()},this)),c=c||Math.sqrt(e*e+f*f)/500,this._dragAnime.setBegins(b),this._dragAnime.setEnds(a),this._dragAnime.setDuration(c),this._dragAnime.start(),this._dragScrolling=!0},MMap.prototype._easeMove=function(a,b){var c=this._dragPixelBak;this._gridComplete=!1,c instanceof MPixel?this._dragPixel[1]=new MPixel(Math.round(c.x+b.x),Math.round(c.y+b.y)):this._dragPixel[1]=new MPixel(Math.round(b.x),Math.round(b.y))},MMap.prototype._resumeMap=function(){var a=this._dragedPixel,b=a?a.x:0,c=a?a.y:0,d=this.size(),e=new MPixel(Math.round(d.width/2-b),Math.round(d.height/2-c));this._setCenter(this.toPoint(e)),this._buildGrid(!0),this._mapContainer.setCss({top:0,left:0}),this._rePaintOverlay(),this._dragedPixel=null,MEvent.trigger(this,"dragend",e,this._center),MTools.timeout(this,function(){this._clearUpGrid()},0)},MMap.prototype._rePaintOverlay=function(){for(var a in this._overlays)this._overlays[a].paint();this._geoMarker&&this._geoMarker.paint(),this._geoRange&&this._showLocationRange();for(var b in this._infoWindows)this._infoWindows[b].owner()||this._infoWindows[b].paint();for(var c in this._panels)this._panels[c]instanceof MPinPanel&&this._panels[c].paint()},MMap.prototype._setZoom=function(a){return"number"==typeof a&&a>=this._minZoom&&a<=this._maxZoom&&a!==this._zoom&&(this._zoom=a,this._updateData(),MEvent.trigger(this,"zoom_changed",this._zoom),!0)},MMap.prototype._setCenter=function(a){if(a instanceof MPoint&&!a.equals(this._center)){var b=a.lng>360?a.lng-360:a.lng<0?360+a.lng:a.lng,c=a.lat>90?90:a.lat<-90?-90:a.lat;return this._center=new MPoint(b,c),MEvent.trigger(this,"center_changed",this._center),!0}return!1},MMap.prototype._setSize=function(a){return a instanceof MSize&&!this._size.equals(a)&&(this._size=a.clone(),this._setContainerSize(),this._updateData(),MEvent.trigger(this,"resize",this._size.clone()),!0)},MMap.prototype._getBounds=function(a,b){var c=this.size(),d=new MPixel(0,c.height),e=new MPixel(c.width,0);return new MBounds(this._getPoint(d,a,b),this._getPoint(e,a,b))},MMap.prototype._getMousePosition=function(a){if(a&&void 0!==a.pageX&&void 0!==a.pageY){var b=this._$dom.offset();return new MPixel(a.pageX-b.x,a.pageY-b.y)}return null},MMap.prototype._getTouchPosition=function(a){if(a&&void 0!==a.pageX&&void 0!==a.pageY){var b=this._$dom.offset();return new MPixel(a.pageX-b.x,a.pageY-b.y)}return null},MMap.prototype._startBuildGrids=function(){this._interval=MTools.interval(this,this._buildGrid,0)},MMap.prototype._setContainerStyle=function(a,b){var c=this.size(),d={position:"absolute",top:0,left:0,padding:0,margin:0,width:c.width+"px",height:c.height+"px"};d=MTools.extend(d,b),a.setCss(d)},MMap.prototype._showOverlayLayers=function(a){a=MTools.ifTypeOf(a,"boolean",!0),a=a?"block":"none",MElement.$$([this._markerContainer,this._shadowContainer,this._canvasContainer,this._layersContainer,this._iwContainer,this._pinPanelContainer]).setCss("display",a)},MMap.prototype._setContainerSize=function(){var a=this._size.width,b=this._size.height;MElement.$$([this._$dom,this._mapContainer,this._mapBackground]).setCss({width:a+"px",height:b+"px"}),this._svgContainer&&this._svgContainer.setAttr({viewBox:[-a,-b,3*a,3*b].join(" "),height:3*b,width:3*a}).setCss({top:-b+"px",left:-a+"px"})},MMap.prototype._addOverlay=function(a,b){a instanceof MOverlay&&(a.setMap(this),b||(this._overlays[a.id()]=a,this._filterOverlay(a)),a.paint())},MMap.prototype._filterOverlay=function(a){(a instanceof MCircle||a instanceof MPolyline)&&(this._vectors[a.id()]=a)},MMap.prototype._startLocation=function(a,b){var c,d=this;return c=navigator.geolocation[a](function(){d._geoSuccess.apply(d,arguments)},function(){d._geoFailed.apply(d,arguments)},{enableHighAccuracy:!!b,maximumAge:3e3,timeout:6e5})},MMap.prototype._encodeGeoServiceData=function(a,b){var c=(new Date).getTime().toString().substring(0,3),d="55"+this._zoom,e=d.substring(d.length-2),f=new MPoint(a,b),g=new MGrid(f,this);d="000000"+g.a_grid_x();var h=d.substring(d.length-6);d="000000"+g.a_grid_y();var i=d.substring(d.length-6),j=g.a_grid_x()*this.lngStep(),k=g.a_grid_y()*this.latStep(),l=this.toPixel(f),m=this.toPixel(new MPoint(j,k));d=l.x-m.x,d<100&&(d+=900);var n=d.toString();d=m.y-l.y,d<100&&(d+=900);var o=d.toString();return{city:"iprule",t:c+e+h+i+n+o,h:this._enabledHighResolution?1:0}},MMap.prototype._decodeGeoServiceResult=function(a){if(a.t){var b=a.t,c=3,d=b.substring(c,c+2);"5"===d.substring(0,1)&&(d=d.substring(1)),d=parseInt(d),d>this._maxZoom&&(d=this._maxZoom),d<this._minZoom&&(d=this._minZoom),c+=2;var e=parseInt(b.substring(c,c+6),10);c+=6;var f=parseInt(b.substring(c,c+6),10);c+=6;var g=parseInt(b.substring(c,c+3),10);g>900&&(g-=900),c+=3;var h=parseInt(b.substring(c,c+3),10);h>900&&(h-=900);var i=e*this.lngStep(d),j=f*this.latStep(d),k=new MPoint(i,j),l=this.toPixel(k);return this.toPoint(l.x+g,l.y-h)}},MMap.prototype._geoSuccess=function(a){var b=a.coords,c=b.latitude,d=b.longitude,e=b.accuracy,f=b.speed,g=b.heading,h=b.altitude,i=b.altitudeAccuracy;MTools.JSONP({url:"http://geocode.mapbar.com/decode/getWeatherByCity.jsp",data:this._encodeGeoServiceData(d,c),context:this,success:function(a){var b=this._decodeGeoServiceResult(a);if(this._setGeoData(b,e),e<=this._validAccuracy){var c=e/111111,d=c,j=new MBounds(new MPoint(b.lng-d,b.lat-c),new MPoint(b.lng+d,b.lat+c));this._enabledPositionMark&&(this.intoView(j),this.setCenter(b),this._showLocation(b),this._showLocationRange()),this.geoSuccess({point:b,accuracy:e,bounds:j,speed:f,heading:g,altitude:h,altitudeAccuracy:i})}else this.geoFailed({error:"accuracy too low"})},error:function(){this.geoFailed({error:"timeout"})}})},MMap.prototype._geoFailed=function(a){this.geoFailed({error:a})},MMap.prototype._showLocation=function(a){this._geoMarker?this._geoMarker.setPoint(a):(this._geoMarker=this._defaultLocationMarker?this._defaultLocationMarker:new MMarker(a,{icon:new MImgIcon("http://img.mapbar.com/maplite/images/stdmobile.png",{anchor:new MPixel(7,7),size:new MSize(13,13),offset:new MPixel(-124,-1)})}),this._addOverlay(this._geoMarker,!0))},MMap.prototype._setGeoData=function(a,b){this._geoPoint=a instanceof MPoint?a:void 0,this._geoAccuracy="number"==typeof b?b:void 0},MMap.prototype._showLocationRange=function(){if(this._geoPoint instanceof MPoint&&"number"==typeof this._geoAccuracy&&(this._geoRange||(this._geoRange=MElement.create$("canvas").setAttr({width:this._size.width,height:this._size.height}).appendTo(this._canvasContainer).get(0)),this._geoRange.getContext)){var a=this._geoAccuracy/111111,b=this._geoRange.getContext("2d"),c=new MPoint(this._geoPoint.lng,this._geoPoint.lat-a),d=this.toPixel(this._geoPoint),e=this.toPixel(c),f=e.y-d.y;MTools.clearCanvas(b),MTools.paintCircle(b,d,f,!0,!0,{fillStyle:"rgba(39, 123, 255, 0.3)",strokeStyle:"rgba(0, 63, 232, 0.3)",lineWidth:1})}},MMap.prototype._setMaxZoom=function(a,b,c,d){var e=this._minZoom,f=MConfig.maxZoom,g=MConfig.minZoom;this._maxZoom="number"==typeof a?Math.min(a,f):f,c||(this._maxZoom=Math.max(this._maxZoom,e||g)),!b&&this.zoom()>this._maxZoom&&this.setZoom(this._maxZoom),!d&&MEvent.trigger(this,"zoomRange_change",this._minZoom,this._maxZoom)},MMap.prototype._setMinZoom=function(a,b,c,d){var e=this._maxZoom,f=MConfig.maxZoom,g=MConfig.minZoom;this._minZoom="number"==typeof a?Math.max(a,g):g,c||(this._minZoom=Math.min(this._minZoom,e||f)),!b&&this.zoom()<this._minZoom&&this.setZoom(this._minZoom),!d&&MEvent.trigger(this,"zoomRange_change",this._minZoom,this._maxZoom)},MMap.prototype._isInBorderRange=function(a,b,c,d,e){var f=!1,g=a.x,h=a.y,i=new MPoint(d.min.lng,d.max.lat),j=new MPoint(d.max.lng,d.max.lat),k=new MPoint(d.max.lng,d.min.lat),l=new MPoint(d.min.lng,d.min.lat),m=this._getPixel(i,e,c),n=this._getPixel(j,e,c),o=this._getPixel(k,e,c),p=this._getPixel(l,e,c),q=n.x-p.x,r=p.y-n.y;if(g>=q/2||h>=r/2)return f=!1;var s=(this._getPoint(new MPixel(m.x+g,m.y+h),e,c),this._getPoint(new MPixel(n.x-g,n.y+h),e,c)),t=(this._getPoint(new MPixel(o.x-g,o.y-h),e,c),this._getPoint(new MPixel(p.x+g,p.y-h),e,c)),u=new MBounds(t,s),v=u.containsRange(b),w=d.containsRange(b);return!1===v&&!0===w&&(f=!0),f},MMap.prototype._initOptions=function(a){this._backgroundColor=MTools.ifUndefined(a.backgroundColor,"#F4F1EC"),this._center=a.center,this._initCenter=this._center.clone(),this._disableDragging=MTools.ifUndefined(a.disableDragging,!1),this._disableIntertialDragging=MTools.ifUndefined(a.disableIntertialDragging,!1),this._enabledBackground=MTools.ifUndefined(a.enabledBackground,!0),this._zoomSteps=MTools.ifUndefined(a.zoomSteps,8),this._enabledDynamicMap=MTools.ifUndefined(a.enabledDynamicMap,!1),this._enabledHighResolution=!this._enabledDynamicMap&&MTools.ifUndefined(a.enabledHighResolution,!1),this._copyrightOpts=MTools.ifUndefined(a.copyrightOpts,{}),this._copyrightOpts.content=MConfig.copyright,this._standardControl=MTools.ifUndefined(a.standardControl,!0),this._standardControlOpts=a.standardControlOpts,this._mapImgServer=MTools.ifUndefined(a.mapImgServer,this._enabledDynamicMap?"http://img1.mapbar.com/advdynamic/02/GetPng/":"http://img[1-9].mapbar.com/maplite/mapbank/stdmobile"+(this._enabledHighResolution?"_h":"")+"/"),this._mapImgFormat=MTools.ifUndefined(a.mapImgFormat,"png"),this._defaultImgIconUrl=MTools.ifUndefined(a.defaultImgIconUrl,"http://img.mapbar.com/maplite/images/stdmobile.png"),this.setResourceUrl(a.resourceUrl),this._autoLoadOfPan=MTools.ifUndefined(a.autoLoadOfPan,!0),this._autoLoadOfZoom=MTools.ifUndefined(a.autoLoadOfZoom,!0),this._enabledGeolocation=MTools.ifUndefined(a.enabledGeolocation,!0),this._enabledPositionMark=MTools.ifUndefined(a.enabledPositionMark,!0),this._trafficImgServer=MTools.ifUndefined(a.trafficImgServer,this._enabledDynamicMap?"http://lukuang.mapbar.com/image/256/GetPng.jsp?":this._enabledHighResolution?"http://lukuang.mapbar.com/mobile/cn/300/":"http://lukuang.mapbar.com/02/"),this._allowMultiInfoWindow=MTools.ifUndefined(a.allowMultiInfoWindow,!1),this._defaultLocationMarker=a.defaultLocationMarker,this._validAccuracy=MTools.ifUndefined(a.validAccuracy,2e3),this._panMapOnOpenInfoWindow=MTools.ifUndefined(a.panMapOnOpenInfoWindow,!0),this._closeInfoWindowOnMapClick=MTools.ifUndefined(a.closeInfoWindowOnMapClick,!0),this._autoAdjustInfoWindowPosition=MTools.ifUndefined(a.autoAdjustInfoWindowPosition,!1),this._getPositionAgent=a.getPositionAgent,this._watchPositionAgent=a.watchPositionAgent,this._stopWatchPositionAgent=a.stopWatchPositionAgent,this._initConfig(a)},MMap.prototype._initConfig=function(a){if(this._enabledDynamicMap)for(var b in MDynamicConfig)MConfig[b]=MDynamicConfig[b];this._zoom=MTools.ifUndefined(a.zoom,8),this._initZoom=this._zoom,this._setMaxZoom(a.maxZoom,!0,!0),this._setMinZoom(a.minZoom,!0),this._disablePinchToZoom=MTools.ifUndefined(a.disablePinchToZoom,!1),this._disableDoubleClickZoom=MTools.ifUndefined(a.disableDoubleClickZoom,!1),this._trafficMinZoom=MTools.ifUndefined(a.trafficMinZoom,MConfig.trafficMinZoom),this._trafficMinZoom=MTools.between(this._trafficMinZoom,this._minZoom,this._maxZoom,this._minZoom),this._trafficMaxZoom=MTools.ifUndefined(a.trafficMaxZoom,this._maxZoom),this._trafficMaxZoom=MTools.between(this._trafficMaxZoom,this._minZoom,this._maxZoom,this._maxZoom)},MMap.pixelDistance=function(a,b,c){var d=parseInt(1e6*a.lng-1e6*b.lng)/1e6,e=parseInt(1e6*b.lat-1e6*a.lat)/1e6;return new MPixel(-Math.round(d/(MMap.lngStep(c)/MConfig.gridWidth)),-Math.round(e/(MMap.latStep(c)/MConfig.gridHeight)-MConfig.standardSafe[c]));
},MMap.lngStep=function(a){return MConfig.lngSteps[a]},MMap.latStep=function(a){return MConfig.latSteps[a]},MMap.gridTCountOfLon=function(a){return parseInt(360/MConfig.lngSteps[a])},MMap.strStyle="@keyframes TILE{0%{opacity:0}100%{opacity:1}}@-webkit-keyframes TILE{0%{opacity:0}100%{opacity:1}}.mapTile{-webkit-animation:TILE 0.2s ease-in-out;animation:TILE 0.2s ease-in-out}#mapBackground .mapTile{-webkit-animation:none;animation:none}",MMap.addStyle=!1,MMap.prototype.isEnabledDynamicMap=function(){return this._enabledDynamicMap},MMap.prototype._buildDynamicGrid=function(a,b){if(a||!this._gridComplete&&!this._timerRun){this._timerRun=!0;var c,d=b||this.bounds(),e=this._zoom,f=this._center,g=MMap.LatLonToPixels(f.lng,f.lat,e),h=Math.floor(g.x/MConfig.gridWidth),i=Math.floor(g.y/MConfig.gridHeight),j=this._scaleX,k=this._scaleY,l=this._maxCol,m=this._maxRow;if(this._dragging){if(this._dragedPixel){var n=this._dragedPixel,o=n.x,p=n.y,q=o*j,r=p*k,s=d.min.lng-q,t=d.min.lat+r,u=d.max.lng-q,v=d.max.lat+r;d=new MBounds(new MPoint(s,t),new MPoint(u,v)),f=d.mid()}}else for(var w in this._grids)MEvent.trigger(this,"grid_updated",this._grids[w]);for(var x=-l-1;x<=l;x++)for(var y=-m-1;y<=m;y++){var z=(h+x)*MConfig.gridWidth,A=(i+y)*MConfig.gridHeight,B=MMap.PixelsToLatLon(z,A,e);c=new MDynamicGrid(B,this),d.isIntersect(c.bounds())&&this._addGrid(c)}this._gridComplete=!0,this._zoomChange=!1,this._timerRun=!1}},MMap.prototype._getDynamicPoint=function(a,b,c){if("number"!=typeof a.x||"number"!=typeof a.y)return null;b=b||this.center(),c=c||this.zoom();var d=MMap.LatLonToPixels(b.lng,b.lat,c),e=a.x-this._ctrX,f=a.y-this._ctrY,g=d.x+e,h=d.y+f;return MMap.PixelsToLatLon(g,h,c)},MMap.prototype._getDynamicPixel=function(a,b,c){if(a instanceof MPoint){b=b||this.center(),c=c||this.zoom();var d=MMap.LatLonToPixels(a.lng,a.lat,c),e=MMap.LatLonToPixels(b.lng,b.lat,c),f=d.x-e.x,g=d.y-e.y,h=this._ctrX+f,i=this._ctrY+g;return new MPixel(h,i)}return null},MMap.prototype._startDynamicZoom=function(a,b){if(!(this._zooming||this._dragging||a>this._maxZoom||a<this._minZoom)){this._showOverlayLayers(!1),this._zooming=!0;var c=this._getPoint(b),d=Math.round(this._ctrX-b.x),e=Math.round(this._ctrY-b.y),f=MMap.LatLonToPixels(c.lng,c.lat,a),g=f.x+d,h=f.y+e,i=this._center,j=MMap.PixelsToLatLon(g,h,a),k=d?j.lng:i.lng,l=e?j.lat:i.lat;this._zoomedCenter=new MPoint(k,l),this._zoomedLevel=a,this._refPixel=b,this._zoomScale=MMap.lngStep(this._zoom)/MMap.lngStep(a),this._startEaseZoom(a,b)}},MMap.LatLonToPixels=function(a,b,c){var d="1.5707963267948966",d=+d,e="57.295779513082323",e=+e,f=40075016.68557849/parseFloat(256*(1<<c)),g=a/e*6378137,h=6378137*-Math.log(Math.tan((d-b/e)/2)),i=parseInt(Math.round((g+20037508.342789244)/f)),j=parseInt(Math.round((20037508.342789244-h)/f));return{x:i,y:j}},MMap.PixelsToLatLon=function(a,b,c){var d="1.5707963267948966",d=+d,e="57.295779513082323",e=+e,f=40075016.68557849/parseFloat(256*(1<<c)),g=a*f-20037508.342789244,h=20037508.342789244-b*f,i=d-2*Math.atan(Math.exp(-h/6378137)),j=g/6378137;return i*=e,j*=e,new MPoint(j%360,i)};